<!DOCTYPE html>
<html>
  <head>
    <title>Virtual World Framework</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/syntax.css" rel="stylesheet">
    <!-- Custom styles -->
    <link href="/css/vwf.css" rel="stylesheet">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>

    <div class="navbar navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">
            <img src="/images/vwf-logo-100x100.png" class="pull-left" alt="VWF Duck Logo">
            <span class="pull-right">Virtual<br>World<br>Framework</span>
          </a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li><a href="/demos.html">Demos</a></li>
            <li><a href="/getting_started.html">Tutorial</a></li>
            <li><a href="/documentation.html">Documentation</a></li>
            <li><a href="/releases.html">Downloads</a></li>
          </ul>
          <a href="http://github.com/virtual-world-framework/vwf" class="btn btn-info navbar-btn pull-right hidden-sm" role="button">View on GitHub</a>
        </div><!--/.nav-collapse -->
      </div>
    </div>

  <div class="container" id="docs">
  <div class="row">
    <div id="nav" class="col-md-2 hidden-sm hidden-xs">
      <div class="nav-wrap" data-spy="affix" data-offset-top="0">
      <ul class="navmenu list-unstyled">
        <li>
          <a href='#install' class='header' title='Introduction'>Installation</a>
        </li>
        <li>
          <a href='#devguide' class='header' title='Dev Guide'>VWF Concepts</a>
          <ul class="list-unstyled">
            <li><a href='#partsofvwf' title='Architecture'>Parts of VWF</a></li>
            <li><a href='#architecture' title='Architecture'>Architecture</a></li>
            <li><a href='#components' title='Components'>Components</a></li>
            <li><a href='#cameras' title='Cameras'>Cameras</a></li>
            <li><a href='#lights' title='Lights'>Lights</a></li>
            <li><a href='#prototypes' title='Prototypes'>Prototypes</a></li>
            <li><a href='#behaviors' title='Behaviors'>Behaviors</a></li>
            <li><a href='#animations' title='Animations'>Animations</a></li>
            <li><a href='#html' title='HTML'>HTML</a></li>
            <li><a href='#drivers' title='Drivers'>Drivers</a></li>
            <li><a href='#editor' title='Editor'>Editor</a></li>
            <li><a href='#querying' title='Querying'>Querying</a></li>
          </ul>
        </li>
        <li>
          <a href='#cookbook' class='header' title='Cookbook'>Cookbook</a>
          <ul class="list-unstyled">
            <li><a href='#multiuser' title='Multiuser'>Multiuser</a></li>
            <li><a href='#simulation' title='Simulation'>Simulation</a></li>
            <li><a href='#2d-interface' title='2D-Interface'>2D Interface</a></li>
            <li><a href='#materials' title='Materials'>Materials</a></li>
            <li><a href='#chat' title='Chat'>Chat</a></li>
            <li><a href='#sound' title='Sound'>Sound</a></li>
            <li><a href='#transforms' title='Transforms'>Transforms</a></li>
            <li><a href='#lesson' title='Lesson'>Lesson</a></li>
            <li><a href='#logging' title='Logging'>Logging</a></li>
            <li><a href='#persistence' title='Persistence'>Persistence</a></li>
            <li><a href='#testing' title='Testing'>Testing</a></li>
            <li><a href='#pitfalls' title='Pitfalls'>Pitfalls</a></li>
          </ul>
        </li>
        <li>
          <a href='#application-api' class='header' title='APIs'>APIs</a>
          <ul class="list-unstyled">
            <li><a href='#application-api' title='Application API'>Application API</a></li>
            <li><a href='#system-api' title='System API'>System API</a></li>
          </ul>
        </li>
        <li>
          <a href='#corecontributors' class='header' title='Core Contributors'>Core Contributors</a>
        </li>
      </ul>
      </div>
      <!-- End documentation specific layout -->
    </div>
    <div id="docs-content" class="col-md-9">
      	
	<h1><a name="install">Installation</a></h1>

<hr>

<h2>Windows</h2>

<!--

Download and run the VWF Windows Installer. 

Launch a command prompt window and create a new VWF application:

    c:\> vwf create MyApp

Change into your new application folder and start the  server.

    c:\> cd MyApp
    c:\MyApp> vwf

-->

<p>Download and extract the latest Windows build from the <a href="https://virtual.wf/releases.html">Downloads</a> page.</p>

<p>Install <a href="http://nodejs.org/">Node.js</a>.</p>

<p>Launch a command prompt and navigate to your <em>vwf</em> folder. </p>

<p>Edit npm configuration settings:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">npm config set registry http://registry.npmjs.org/
</code></pre></div>
<p>Note: You may also need to set a proxy if required by your network:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">npm config set strict-ssl false
npm config set proxy http://yourproxy.com:80
npm config set https-proxy http://yourproxy.com:80
</code></pre></div>
<p>Install all the prerequisites for the VWF server:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">npm install
</code></pre></div>
<p>Start the server:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">npm start
</code></pre></div>
<p>Navigate to &quot;localhost:3000&quot; to see the sample duck application from your local machine.</p>

<h2>Mac OS X / Linux</h2>

<p>NOTE: On Mac OS X, please make sure you have <a href="https://developer.apple.com/xcode/">Xcode Command Line Tools</a> installed prior to executing the script.</p>

<p>Execute the following command at your terminal/shell prompt:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">$ curl -L http://get.virtual.wf  | sh
</code></pre></div>
<p>Launch a command prompt window and create a new VWF application:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">$ vwf create MyApp
</code></pre></div>
<p>Change into your new folder application, and start the server.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">$ cd MyApp
MyApp$ vwf
</code></pre></div>
<h2>Demo Apps</h2>

<p>For additional VWF app examples, download the <a href="https://github.com/virtual-world-framework/vwf-apps/archive/master.zip">vwf-apps repo</a>, and unzip to your <em>public</em> directory. </p>

<hr>

	
	<h2><a name="troubleshooting">Troubleshooting</a></h2>

<p>The following resources may be helpful for troubleshooting any issues that arise.</p>

<ul>
<li><p>Verify <a href="#install">installation instructions</a> were followed.</p></li>
<li><p>Load an application, and verify all the requirements are met on the loading screen. </p></li>
<li><p>Open the developer console to check for any error messages. </p>

<ul>
<li><p>In Google Chrome, press Ctrl+Shift+J or select the tools menu -&gt; Tools -&gt; Developer Tools -&gt; JavaScript Console. </p>

<p><img src='images/chrome.png' alt='chrome' style='width:500px' /></p></li>
<li><p>In Mozilla Firefox, download and install <a href="https://addons.mozilla.org/en-us/firefox/addon/firebug">Firebug</a>. Select the bug icon in the upper right of the browser to run, and then select the Console window. </p>

<p><img src='images/firebug.png' alt='firebug' style='width:500px' /></p></li>
</ul></li>
</ul>

	
	<h1><a name="devguide">VWF Concepts</a></h1>

<p>If you haven&#39;t already built your first VWF app by following our <a href="getting_started.html">tutorial</a>, we highly recommend it!</p>

<p>This section will expand upon what you learned in the tutorial and run through some VWF concepts that will help you create your VWF apps.</p>

	
	<h2><a name="partsofvwf">Parts of VWF</a></h2>

<div style='width:100%;text-align:center'><img src='images/vwf-onion.png' alt='arch' width='512' /></div>

<p>VWF consists of two pieces:</p>

<ol>
<li>Core: Consists of the server and part of the client and ensures synchronization between the model state on every client.</li>
<li>Drivers: Add functionality to VWF by providing access to 3rd party libraries (like three.js for graphics)</li>
</ol>

<p>VWF enables one to create:</p>

<ol>
<li>Components: A meaningful unit of functionality. Components are the building blocks of VWF applications.  A component might contain a 3D model and/or it might contain some functionality.</li>
<li>Applications: This is a full VWF ... well ... application.  It&#39;s something that a user can sit down and use.</li>
</ol>

<p>The VWF ecosystem is everything that exists to help developers create components and applications.  Many of the items listed in the <em>Ecosystem</em> circle are works in progress.</p>

<hr>

<h2><a name="architecture">Anatomy of a VWF App</a></h2>

<p>VWF allows you to ignore the complexity of sharing state between multiple users. You focus on the logic of your app, and as long as you follow VWF conventions, nothing else must be done to achieve a synchronized state across multiple users. </p>

<p>Let&#39;s look at the anatomy of a VWF app to understand a little of how it works under the hood.</p>

<h3>Model-view architecture</h3>

<p>VWF has a model-view based architecture. Views exist for each client joined in the app. Each view provides input into a model that keeps track of the state of the simulation. </p>

<div style='width:100%;text-align:center'><img src='images/arch1.png' alt='arch' width='512' /></div>

<p>The single model, or shared state, of the application has multiple copies that represent the shared simulation. </p>

<div style='width:100%;text-align:center'><img src='images/arch2.png' alt='arch' width='512' /></div>

<p>Each client then has their own replicated model that they take with them. The model, however, remains the same as the one that every other user is viewing. All clients show the same state with each having an identical copy of the app. The app are separately but simultaneously updated to retain identical states. </p>

<p>The app then is a state machine. The same state machine is in different locations (different clients). If the state machines all have the same properties and children, they will all move to the same successive state.</p>

<p>A client&#39;s browser may have multiple views. For example, a user may see a renderer view and an editor view in their browser window. The renderer view shows a 3D visualization of the model state, and the editor view shows the hierachy of the scene and the pieces that make it up such as it&#39;s properties and children.</p>

<div style='width:100%;text-align:center'><img src='images/arch3.png' alt='arch' width='512' /></div>

<p>External inputs from one user get thrown &quot;across the moat&quot; into the shared simulation (model) [1]. The model deflects incoming input from a view, and sends it directly to the reflector [2]. The reflector can then send out the information to all of the replicated models [3]. Thus all inputs to a model happen identically on the timeline to all clients within the application. </p>

<div style='width:100%;text-align:center'><img src='images/arch4.png' alt='arch' width='512' /></div>

<p>The architecture separates external input from internal input. All external input (ie. user input from a view), once received by the model is deferred to the reflector, which then sends it out to everyone. However, the model is free to make any additional state changes (ie. internal input) provided that it was caused by something internal to the model. This would include things such as setter methods that can manipulate other internal properties. </p>

<h3>The Model side</h3>

<p>The application&#39;s main model file is usually named <code>index.vwf.yaml</code>.  The <code>index</code> part can actually be replaced with any name, but if it is named <code>index.vwf.yaml</code>, the filename is not necessary in the browser url (only the path leading to it).  It can actually also be a .json file instead (<code>index.vwf.json</code>).  We use .yaml because of its human-readableness.</p>

<p>Everything in the <em>model</em> is automatically syncrhonized across all users.  Let&#39;s take a look at how the model is composed.</p>

<h4>Nodes</h4>

<p>A <em>node</em> is the atomic unit of state in the VWF model.  The application&#39;s entire model state is comprised of a tree of nodes.</p>

<h4>Components</h4>

<p>A tree of nodes that forms a functional unit (for example, a tree composed of a car node that has four children tire nodes) is called a <em>component</em>.</p>

<p>Since a component can actually be made from a single node (since that is technically a tree ... just a very simple one), you will sometimes catch us calling individual nodes components.</p>

<p>To summarize: the model side of a VWF application is made up of one or more components, which are in-turn made up of one or more components.  Like this:</p>

<div style='width:100%;text-align:center'><img src='images/arch5.png' alt='arch' width='600' /></div>

<p>Additionally, components may extend prototype components, and will inherit their properties, methods, and events. A prototype may have multiple components that extend it in an application.  Like this:</p>

<div style='width:100%;text-align:center'><img src='images/arch6.png' alt='arch' width='600' /></div>

<p>Since components are such a big deal in VWF, we&#39;ll come back to them in more detail in the <a href="#components">components</a> section where we show you the structure of a component definition.  And if you want to see what components already exist inside VWF that you can use as prototypes in your applications, check out the <a href="#prototypes">prototypes</a> section. </p>

<p>But for now, let&#39;s move onto talking about the other half of a VWF application ... the <em>view</em>.</p>

<h3>The View side</h3>

<p>The application&#39;s main model file is usually named <code>index.vwf.html</code>.  Again, just like the model file, it can actually be named anything, but the part before the <code>vwf.html</code> needs to match that part of the model files name.</p>

<p>The view side is what the user interacts with.  It contains the logic for anything that is user-specific (like the logic for a user controlling their personal avatar, etc).  Therefore, the view is not synchronized across every user.</p>

<p>The main file is an html file, and it is the primary means for creating 2D elements in your application (3D elements are handled by the three.js driver, but that is a topic for later).  From this file you may also include untold numbers of <code>.js</code> files to implement view-side logic (like the aformentioned user controlling their avatar).</p>

<p>In a VWF application, the model does not know that the view exists.  The view knows that the model exists and can listen for changes to it (and perform some view-side logic as a result).  It can also take user input and create its own changes to the model by setting properties and calling methods (etc) on those components we mentioned in the last section.</p>

<hr>

	
	<h2><a name="components">Components</a></h2>

<p>Components define the behavior, state and visual representation of an object and are the basic building blocks of VWF. Components make up a hierarchical structure, with each component acting as the parent or child to another component. At the root of the structure is the application, which is also a component, and is created automatically when the application loads.</p>

<hr>

<h3>Component Contents</h3>

<p>There are eight parts that make up a component, seen here as a skeleton in YAML.</p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="nn">---</span>
<span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span>
<span class="l-Scalar-Plain">implements</span><span class="p-Indicator">:</span>
<span class="l-Scalar-Plain">source</span><span class="p-Indicator">:</span>
<span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span>
<span class="l-Scalar-Plain">properties</span><span class="p-Indicator">:</span>
<span class="l-Scalar-Plain">methods</span><span class="p-Indicator">:</span>
<span class="l-Scalar-Plain">events</span><span class="p-Indicator">:</span>
<span class="l-Scalar-Plain">children</span><span class="p-Indicator">:</span>
<span class="l-Scalar-Plain">scripts</span><span class="p-Indicator">:</span>
</code></pre></div>
<p>Each part is optional and only needs to be included in the component definition if that part needs to be customized in the component. All relative paths are resolved using the current component as the base.</p>

<h4>extends</h4>

<p>This specifies the URI or descriptor of the prototype component that is extended to make the new component. All behaviors, properties, methods, events, children and scripts are inherited by the component. The default prototype is <code>http://vwf.example.com/node.vwf</code>.</p>

<p>To specify a prototype using a URI, simply provide the URI.</p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://vwf.example.com/path/to/prototype.vwf</span>
</code></pre></div>
<p>Since a prototype is also a component, it can be specified using the same format.</p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">implements</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">source</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">properties</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">methods</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">events</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">children</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">scripts</span><span class="p-Indicator">:</span>
</code></pre></div>
<p>See <a href="#prototypes">prototypes</a> for more information.</p>

<h4>implements</h4>

<p>This specifies the URIs of components that will be used as behaviors. All behaviors, properties, methods, events, children and scripts are inherited by the component, allowing functionality to be added from a separate file.</p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">implements</span><span class="p-Indicator">:</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">http://vwf.example.com/path/to/behavior.vwf</span>
</code></pre></div>
<p>See <a href="#behaviors">behaviors</a> for more information.</p>

<h4>source/type</h4>

<p>The source and type allow the component to load a seperate data blob, usually in the form of a 3D model or image. Source is the URI of the data, and type is the MIME type. If type is not specified, it will default to the MIME type taken from the server&#39;s response.</p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">source</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">model.dae</span>
<span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">model/vnd.collada+xml</span>
</code></pre></div>
<h4>properties</h4>

<p>Properties are the public variables of the component. The component inherits properties from its prototype and any behaviors. Initializing a property will override any default values from the prototype or behavior.</p>

<p>The declaration for a property provides only a name, and an optional value.</p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">properties</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">aProperty</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">value</span>
</code></pre></div>
<p>Properties can also be declared with accessor functions that allow the component to detect changes, allow only acceptable values, or serve as a proxy for another property. </p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">properties</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">aProperty</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">set</span><span class="p-Indicator">:</span> <span class="p-Indicator">|</span> <span class="c1"># calculate and set the value</span>
      <span class="no">this.aProperty = value</span>
    <span class="l-Scalar-Plain">get</span><span class="p-Indicator">:</span> <span class="p-Indicator">|</span> <span class="c1"># calculate and return the value</span>
      <span class="no">return this.aProperty</span>
    <span class="l-Scalar-Plain">value</span><span class="p-Indicator">:</span> <span class="c1"># the value is available to the accessor functions</span>
      <span class="l-Scalar-Plain">value</span>
</code></pre></div>
<h4>methods</h4>

<p>Methods are the public functions of the component. The component inherits methods from its prototype and behaviors. Redefining those methods here will override the inherited ones.</p>

<p>The method declaration only provides the body of the method.</p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">methods</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">aMethod</span><span class="p-Indicator">:</span> <span class="p-Indicator">|</span>
    <span class="no">// method body</span>
</code></pre></div>
<p>The extended method specifier allows named parameters. Additional parameters can still be parsed out of the arguments object when needed.</p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">methods</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">anotherMethod</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">parameters</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">one</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">two</span>
    <span class="l-Scalar-Plain">body</span><span class="p-Indicator">:</span> <span class="p-Indicator">|</span>
      <span class="no">var three = arguments[2];</span>
      <span class="no">this.something(one, two, three);</span>
</code></pre></div>
<p>Methods can also be declared empty, and intialized in a script later.</p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">methods</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">aMethod</span><span class="p-Indicator">:</span>
<span class="l-Scalar-Plain">scripts</span><span class="p-Indicator">:</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">|</span>
  <span class="no">this.aMethod = function(one, two, three) {</span>

  <span class="no">}</span>
</code></pre></div>
<h4>events</h4>

<p>Events define the outgoing messages a node can trigger. The component inherits events from its prototype and behaviors. </p>

<p>The event specifier only provides the name of the event.</p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">events</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">anEvent</span><span class="p-Indicator">:</span>
</code></pre></div>
<p>The extended event specifier describes the arguments passed to the event. As with methods, additional parameters can still be parsed out of the arguments object in the event handler.</p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">events</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">anotherEvent</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">parameters</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">one</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">two</span>
</code></pre></div>
<p>To listen for events, a javascript function that matches the event name is added to the Scripts section of the component.</p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">events</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">anEvent</span><span class="p-Indicator">:</span>
<span class="l-Scalar-Plain">scripts</span><span class="p-Indicator">:</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">|</span>
  <span class="no">this.anEvent = function() {</span>

  <span class="no">}</span>
</code></pre></div>
<p>VWF also defines several dispatched events. These are triggered when outside actions, such as a key press or mouse click occur. When one of these events occurs, the system automatically finds any nodes that have been definined as triggering the event, and dispatches the event from those nodes. Currently, the dispatched events defined by VWF are:</p>

<ul>
<li><code>keyDown</code></li>
<li><code>keyUp</code></li>
<li><code>pointerClick</code></li>
<li><code>pointerDown</code></li>
<li><code>pointerOver</code></li>
<li><code>pointerHover</code></li>
<li><code>pointerOut</code></li>
<li><code>pointerMove</code></li>
<li><code>pointerUp</code></li>
<li><code>pointerWheel</code></li>
</ul>

<h4>children</h4>

<p>Children are instances of other components that are attached to this component. A child can be a simple reference to a separate component, or the reference can include a configuration. The format for a child specification is the same as for a component.</p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">children</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">childFromURI</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://vwf.example.com/path/to/component.vwf</span>
  <span class="l-Scalar-Plain">childFromDescriptor</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://vwf.example.com/path/to/component.vwf</span>
    <span class="l-Scalar-Plain">properties</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">something</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">value</span>
  <span class="l-Scalar-Plain">childFromDescriptorDetailed</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://vwf.example.com/path/to/prototype.vwf</span>
    <span class="l-Scalar-Plain">implements</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">http://vwf.example.com/path/to/behavior.vwf</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">http://vwf.example.com/a/different/behavior.vwf</span>
    <span class="l-Scalar-Plain">source</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">asset.dat</span>
    <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">mime/type</span>
    <span class="l-Scalar-Plain">properties</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">descriptor</span>
      <span class="l-Scalar-Plain">another</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">descriptor</span>
    <span class="l-Scalar-Plain">methods</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">descriptor</span>
      <span class="l-Scalar-Plain">another</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">descriptor</span>
    <span class="l-Scalar-Plain">events</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">descriptor</span>
      <span class="l-Scalar-Plain">another</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">descriptor</span>
    <span class="l-Scalar-Plain">children</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">component</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">another</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">component</span>
    <span class="l-Scalar-Plain">scripts</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">specifier</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">specifier</span>
</code></pre></div>
<h4>scripts</h4>

<p>Scripts define the component&#39;s internal behavior and can be used to create and use private variables and methods, and event handlers. Currently the only language supported for scripts is JavaScript.</p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">scripts</span><span class="p-Indicator">:</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">|</span>
  <span class="no">var aVariable;</span>
  <span class="no">this.aFunction = function() {</span>
    <span class="no">...</span>
  <span class="no">}</span>
</code></pre></div>
<p>Inside a script <code>this</code> always refers to the component that owns the script. Other components can be accessed by navigating up or down the component hierarchy using <code>this.parent</code> and <code>this.children.childName</code>. VWF also defines an <code>initialize</code> function that is automatically executed when a component is initialized. In order to use this function, define it like any other function.</p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">scripts</span><span class="p-Indicator">:</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">|</span>
  <span class="no">this.initialize = function() {</span>
    <span class="no">...</span>
  <span class="no">}</span>
</code></pre></div>
<hr>

<h3>Manipulating Components With JavaScript</h3>

<p>The various parts of a component can also be modified from JavaScript after the component has been initialized as a node. VWF defines several functions to make these changes.</p>

<h4>properties</h4>

<p>New properties can be added using the following syntax.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s2">&quot;propertyName&quot;</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
</code></pre></div>
<p>The first parameter is the name of the new property, and the second is its initial value. There are also two optional parameters that customize the getter and setter of the parameter. These are passed in as strings.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s2">&quot;propertyName&quot;</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="s2">&quot;return this.propertyName;&quot;</span><span class="p">,</span> <span class="s2">&quot;this.propertyName = value;&quot;</span><span class="p">);</span>
</code></pre></div>
<h4>methods</h4>

<p>New methods can be added using the following syntax.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">methods</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s2">&quot;methodName&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">methodParameters</span><span class="p">,...],</span> <span class="nx">methodBody</span><span class="p">);</span>
</code></pre></div>
<p>The first parameter is the name of the new method, the second is an array of any parameters the method will take, and the third is the body of the method, as a string.</p>

<h4>events</h4>

<p>Creating a new event uses the following syntax.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s2">&quot;eventName&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">eventParameters</span><span class="p">]);</span>
</code></pre></div>
<p>The first parameter is the name of the new event and the second is an array of any parameters the event will take.</p>

<p>New event listeners can also be added.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">eventName</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">},</span> <span class="nx">phases</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">listeningNode</span><span class="p">,</span> <span class="nx">callback</span> <span class="cm">/* listenerID */</span><span class="p">);</span>
</code></pre></div>
<p>The first parameter is the function that will be executed when the event occurs.</p>

<p>The second parameter is optional and defaults to <code>&quot;bubble&quot;</code>. Setting phases to <code>&quot;capture&quot;</code> will prevent the event from propagating to other nodes.</p>

<p>The third parameter will be used as the <code>this</code> value for the event and defaults to the node firing the event. Setting the parameter to the node listening for the event allows the listener function to find its node more easily. This parameter is also optional.</p>

<p>The final parameter is an optional callback function to receive the ID assigned to the listener. The listener ID is used to remove the listener from the event.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">eventName</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">listenerID</span><span class="p">);</span>
</code></pre></div>
<h4>children</h4>

<p>A component can be written as a JavaScript object in the following format.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">component</span> <span class="o">=</span> <span class="p">{</span>
  <span class="kr">extends</span><span class="o">:</span> <span class="s2">&quot;http://vwf.example.com/path/to/prototype.vwf&quot;</span><span class="p">,</span>
  <span class="kr">implements</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;http://vwf.example.com/path/to/behavior.vwf&quot;</span><span class="p">],</span>
  <span class="nx">properties</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">aProperty</span><span class="o">:</span> <span class="nx">value</span>
  <span class="p">},</span>
  <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">aMethod</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">parameter</span><span class="p">,</span> <span class="p">...</span> <span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">},</span>
    <span class="nx">anotherMethod</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">parameter</span><span class="p">,</span> <span class="p">...</span> <span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
  <span class="p">},</span>
  <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">anEvent</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">},</span>
    <span class="nx">anotherEvent</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
  <span class="p">},</span>
  <span class="nx">children</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">childFromURI</span><span class="o">:</span> <span class="s2">&quot;http://vwf.example.com/path/to/component.vwf&quot;</span><span class="p">,</span>
    <span class="nx">childFromDescriptor</span><span class="o">:</span> <span class="p">{</span>
      <span class="kr">extends</span><span class="o">:</span> <span class="s2">&quot;http://vwf.example.com/path/to/component.vwf&quot;</span><span class="p">,</span>
      <span class="nx">properties</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">something</span><span class="o">:</span> <span class="s2">&quot;value&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nx">scripts</span><span class="o">:</span> <span class="p">[</span>  <span class="s2">&quot;this.aFunction = function() { ... }&quot;</span><span class="p">]</span>
<span class="p">};</span>
</code></pre></div>
<p>From inside an existing node, the new component can be created using the following syntax.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s2">&quot;componentName&quot;</span><span class="p">,</span> <span class="nx">component</span><span class="p">);</span>
</code></pre></div>
<p>The first argument is the name of the new component to be created, and the second is the JavaScript object for the component itself. The new component will be created as a child of <code>this</code>, and will be treated the same as any other children that were already present.</p>

<p>Children can also be deleted. The delete function takes the JavaScript object of the child that will be deleted.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">component</span><span class="p">);</span>
</code></pre></div>
	
	<h2><a name="cameras">Cameras</a></h2>

<p>The camera capability provides the users a viewpoint into the app. Every app automatically creates a camera as part of the scene. This camera can be accessed in javascript through the <code>camera</code> property of the scene node, or through the editor. </p>

<hr>

<h3>Creating New Cameras</h3>

<p>New cameras can be created by creating a node that extends <code>http://vwf.example.com/camera.vwf</code>. </p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">newCamera</span> <span class="o">=</span> <span class="p">{</span>
  <span class="kr">extends</span><span class="o">:</span> <span class="s2">&quot;http://vwf.example.com/camera.vwf&quot;</span>
<span class="p">};</span>
<span class="k">this</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s2">&quot;newCamera&quot;</span><span class="p">,</span> <span class="nx">newCamera</span><span class="p">);</span>
</code></pre></div>
<p>See <a href="#components">components</a> for more information about creating new nodes.</p>

<hr>

<h3>Camera Type</h3>

<p>The <code>cameraType</code> property controls whether the camera is a <em>persepective</em> or <em>orthographic</em> camera. With a perspective camera, the further away an object is, the smaller it will appear. Orthographic cameras always display objects as their actual size. <code>cameraType</code> defaults to <em>perspective</em> and can be set using the following syntax.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="s1">&#39;newCamera&#39;</span><span class="p">].</span><span class="nx">cameraType</span> <span class="o">=</span> <span class="s2">&quot;orthographic&quot;</span><span class="p">;</span>
</code></pre></div>
<hr>

<h3>Transform Properties</h3>

<p>The camera component extends from node3, and inherits the transform properties, such as translation and rotation. </p>

<p>The <code>translation</code> property controls the position of the camera. Changing this property will move the camera to the new coordinates, and the view will automatically update with it. <code>translation</code> defaults to [ 0, 0, 0 ] and can be set using the following syntax. The coordinate system defaults to +x to the right, +y forward, and +z up, if no rotation has been applied.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="c1">// Moves the camera to 100 on the x-axis, -20 on the y-axis, and 30 on the z-axis</span>
<span class="k">this</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="s1">&#39;newCamera&#39;</span><span class="p">].</span><span class="nx">translation</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">30</span> <span class="p">];</span>
</code></pre></div>
<p>The <code>rotation</code> property controls the direction the camera is pointing, as an offset from the default orientation. Changing this property will rotate the camera and automatically update the view. The value takes the from of [ x, y, z, angle ] where the amount rotation around an axis is axis * angle. </p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="s1">&#39;newCamera&#39;</span><span class="p">].</span><span class="nx">rotation</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">90</span> <span class="p">];</span> 
<span class="c1">// From looking down the positive y-axis, rotate 90 degrees </span>
<span class="c1">// around the x-axis, rotation 180 degrees around the y-axis </span>
<span class="c1">// and 45 degrees around the z-axis.</span>
</code></pre></div>
<p>Note that the x, y and z values in the rotation array are automatically normalized to a unit vector. So after the above example, reading the value of <code>rotation</code> would return [ 0.4364357888698578, 0.8728715777397156, 0.21821792423725128, 90 ].</p>

<hr>

<h3>Clipping Plane</h3>

<p>The <code>near</code> and <code>far</code> properties are used to control the clipping plane. <code>far</code> controls how far away from the camera another node can get before it is no longer displayed and <code>near</code> property controls how close to the camera another node can get before it is no longer displayed. The values of <code>near</code> and <code>far</code> are restricted so that 0 &lt; <code>near</code> &lt; <code>far</code>. They can be set with the following syntax.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="s1">&#39;newCamera&#39;</span><span class="p">].</span><span class="nx">far</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">;</span>
<span class="k">this</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="s1">&#39;newCamera&#39;</span><span class="p">].</span><span class="nx">near</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
</code></pre></div>
<p><code>near</code> and <code>far</code> also control the view buffer. The ratio of <code>far / near</code> should roughly match the size of the world, in order to have accurate depth calculations and avoid overlapping models.</p>

<hr>

<h3>Lookat</h3>

<p>The <code>lookAt</code> property affects how the camera moves. If it is set to the id of another node, that node will always be at the center of the cameras view. If the position of the camera changes, the camera will automatically stay pointed at the other node. <code>lookAt</code> can only be set to a valid id, and defaults to &quot;&quot;. It can be set using the following syntax.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="s1">&#39;newCamera&#39;</span><span class="p">].</span><span class="nx">lookAt</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="s1">&#39;interestingNode&#39;</span><span class="p">].</span><span class="nx">id</span><span class="p">;</span>
</code></pre></div>
<hr>

<h3>Using Multiple Cameras</h3>

<p>The application uses the <code>activeCamera</code> property of the scene to determine which camera to use as the main viewpoint. Other cameras can be created, but they will not affect what is displayed in the browser unless they have been set as the active camera. Cameras in the model are shared by all clients, and <code>activeCamera</code> will be seen by all clients, unless they switch to a different one in their private view. Setting <code>activeCamera</code> to the id of a camera will automatically switch the view that is displayed in the browser to the view of that camera.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="c1">// this is the scene</span>
<span class="k">this</span><span class="p">.</span><span class="nx">activeCamera</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">children</span><span class="p">[</span><span class="s1">&#39;newCamera&#39;</span><span class="p">].</span><span class="nx">id</span><span class="p">;</span>
</code></pre></div>
	
	<h2><a name="lights">Lights</a></h2>

<p>VWF provides control of lighting within an app or default lighting if none is specified. There are three basic light types that can be created within the framework. Each light has properties associated with it that can be manipulated, including attenuation, effects, and shadows. A complete list of light properties can be found under <a href="https://demo.virtual.wf/web/docs/jsdoc_cmp/symbols/light.vwf.html">light</a> in the <a href="#application-api">Application API</a>.</p>

<hr>

<h3>Light Types</h3>

<h4>Point</h4>

<p>A point light is represented by a point source in 3D space, and emits light in all directions. The closer an object is to the light source, the more illuminated it becomes.</p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">Omni1</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://vwf.example.com/light.vwf</span>
  <span class="l-Scalar-Plain">properties</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">lightType</span><span class="p-Indicator">:</span> <span class="s">&quot;point&quot;</span>
    <span class="l-Scalar-Plain">translation</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span> <span class="nv">-150</span><span class="p-Indicator">,</span> <span class="nv">150</span><span class="p-Indicator">,</span> <span class="nv">150</span> <span class="p-Indicator">]</span>
</code></pre></div>
<h4>Directional</h4>

<p>Directional lights equally illuminate all objects from a given direction. An application should only have a small number of directional lights if needed, as computations for directional lights need to be done on all pixels on the screen. </p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">Dir1</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://vwf.example.com/light.vwf</span>
  <span class="l-Scalar-Plain">properties</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">lightType</span><span class="p-Indicator">:</span> <span class="s">&quot;directional&quot;</span>
    <span class="l-Scalar-Plain">rotation</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span> <span class="nv">1</span><span class="p-Indicator">,</span> <span class="nv">0</span><span class="p-Indicator">,</span> <span class="nv">0</span><span class="p-Indicator">,</span> <span class="nv">-10</span> <span class="p-Indicator">]</span>
</code></pre></div>
<h4>Spot</h4>

<p>Spot lights emit light in a cone shape instead of a sphere. Other than that, spot lights and point lights share the similar properties. Spot lights also have the additional properties of <code>spotCosCutOff</code> and <code>spotExponent</code>, as described in the light API.</p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">Spot1</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://vwf.example.com/light.vwf</span>
  <span class="l-Scalar-Plain">properties</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">lightType</span><span class="p-Indicator">:</span> <span class="s">&quot;spot&quot;</span>
    <span class="l-Scalar-Plain">spotCosCutOff</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">0.95</span>
    <span class="l-Scalar-Plain">spotExponent</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">10</span>
    <span class="l-Scalar-Plain">translation</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span> <span class="nv">-150</span><span class="p-Indicator">,</span> <span class="nv">150</span><span class="p-Indicator">,</span> <span class="nv">150</span> <span class="p-Indicator">]</span>
</code></pre></div>
<hr>

<h3>Lighting Effects</h3>

<h4>Specular</h4>

<p>Specular reflection is the reflection of light from a surface where the ray is reflected in a single direction.</p>

<h4>Diffuse</h4>

<p>Diffuse reflection is the reflection of light from a surface where the ray is reflected at many angles.</p>

	
	<h2><a name="prototypes">Prototypes</a></h2>

<p>Prototypes are the base component types for inheritance in the Virtual World Framework. A prototype has the same structure as a VWF <a href="#components">component</a>, and contains common properties, methods, and events. </p>

<p>A component can inherit from a prototype by using the <code>extends</code> keyword and specifying the URI of the prototype component. All behaviors, properties, methods, events, children and scripts are inherited by the component. </p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">extends: http://vwf.example.com/path/to/prototype.vwf
</code></pre></div>
<p>The default values for properties are defined in the prototype file. These properties can be overridden in the component definition file, or left alone to keep the default value. The same is true for methods and events, which can be extended in the component definition. </p>

<p>The default prototype for all components is <code>http://vwf.example.com/node.vwf</code>.</p>

<p>Prototypes can be housed on any server, and any URI passed to the extends keyword. Common VWF prototypes use a URI of <code>vwf.example.com</code>.</p>

<h4>Common Prototypes</h4>

<ul>
<li><code>node2.vwf</code> - base type for 2D components</li>
<li><code>node3.vwf</code> - base type for 3D components</li>
<li><code>camera.vwf</code> - base type for cameras</li>
<li><code>light.vwf</code> - base type for lights</li>
<li><code>material.vwf</code> - base type for materials</li>
<li><code>scene.vwf</code> - base type for a scene</li>
</ul>

<p>The <a href="#application-api">Application API</a> covers the complete list of VWF prototypes and their property, method, and event definitions.</p>

	
	<h2><a name="behaviors">Behaviors</a></h2>

<p>A behavior is a component that is used to add functionality to another component. It is referenced from a seperate file, allowing multiple components to reuse the same behavior. To use a behavior, add an <code>implements</code> section to the component with the URI to the behavior.</p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">implements</span><span class="p-Indicator">:</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">http://vwf.example.com/path/to/behavior.vwf</span>
</code></pre></div>
<p>When a behavior is loaded, all behaviors, properties, methods, events, children and scripts are inherited by the new component. All the inherited functionality can be used as part of the component. Behaviors can also use properties from the component that implement the behavior. For example, in this behavior, <code>someMethod</code> will perform an action based on the value of <code>behavior-someProperty</code>, which defaults to true. The convention for properties from the behavior is to prefix the property name with the name of the behavior, to avoid accidently overriding the value with a property from the implementing component.</p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="nn">---</span>
<span class="l-Scalar-Plain">properties</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">behavior-someProperty</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span> 
<span class="l-Scalar-Plain">methods</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">someMethod</span><span class="p-Indicator">:</span> <span class="p-Indicator">|</span>
    <span class="no">if(this.behavior-someProperty &amp;&amp; this.anotherProperty) {</span>
      <span class="no">// Do something</span>
    <span class="no">}</span>
    <span class="no">else {</span>
      <span class="no">// Do something else</span>
    <span class="no">}</span>
</code></pre></div>
<p><code>anotherProperty</code> is defined in the implementing component, but is still usable in the behavior. If the component that is implementing the behavior needs <code>behavior-someProperty</code> to be false, it simply overrides the value in its own properties. </p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="nn">---</span>
<span class="l-Scalar-Plain">implements</span><span class="p-Indicator">:</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">http://vwf.example.com/path/to/behavior.vwf</span>
<span class="l-Scalar-Plain">properties</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">behavior-someProperty</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">false</span>
  <span class="l-Scalar-Plain">anotherProperty</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
<span class="l-Scalar-Plain">scripts</span><span class="p-Indicator">:</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">|</span>
  <span class="no">this.doSomething = function() {</span>
    <span class="no">this.someMethod();</span>
  <span class="no">}</span>
</code></pre></div>
<p>When <code>someMethod</code> executes, it will read the overridden value of <code>behavior-someProperty</code>, and go into the else statement.</p>

	
	<h2><a name="animations">Animations</a></h2>

<h3>Animation Behavior</h3>

<p>The primary way to accomplish animations in VWF is the animation behavior. All components that extend node3 automatically implement the animation behavior, which provides standardized methods and properties for creating and executing an animation. </p>

<p>In order to create an animation on a node, the <code>animationUpdate</code> method needs to be implemented. This method is called each time the animation time changes, and is used to update the node to the correct state for that time.</p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">scripts</span><span class="p-Indicator">:</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">|</span>
  <span class="no">this.animationUpdate = function(time, duration) {</span>
    <span class="no">// Animate the node. For example, update the translation based on the time</span>
    <span class="no">this.translateBy([0, 0, 1 * time], 0);</span>
  <span class="no">}</span>
</code></pre></div>
<p>The animation can then be started by calling the <code>animationPlay</code> method and stopped by calling <code>animationStop</code>.</p>

<p>Common properties used to customize the animation include:</p>

<ul>
<li><code>animationDuration</code> - The length of the animation</li>
<li><code>animationRate</code> - The animation playback rate</li>
<li><code>animationLoop</code> - Whether or not the animation should replay after reaching the end</li>
</ul>

<p>A full list of methods and properties can be found under <a href="https://demo.virtual.wf/web/docs/jsdoc_cmp/symbols/animation.vwf.html">animation</a> in the <a href="#application-api">Application API</a>.</p>

<hr>

<h3>Collada Animations</h3>

<p>Animations defined in the collada document will also be loaded and available to the framework. They are controlled the same way as animations created in a component, except there is no need to implement an <code>animationUpdate</code> method, since the animation information is pulled from the collada file.</p>

<p>Common properties used to customize collada animations include:</p>

<ul>
<li><code>animationStartTime</code> - The time the animation should start at. Used to play a subsection of the animation.</li>
<li><code>animationStopTime</code> - The time the animation should stop at. Used to play a subsection of the animation.</li>
<li><code>animationStartFrame</code> - Equivalent to animationStartTime, but in frames, instead of seconds.</li>
<li><code>animationStopFrame</code> - Equivalent to animationStopTime, but in frames, instead of seconds.</li>
<li><code>fps</code> - The frames per second the animation should play at.</li>
</ul>

<hr>

<h3>Future Call</h3>

<p>Animations can also be created using the future call. The VWF future call can be used to run a method at a specified time in the future. This call can be inserted into the method call chain, and a parameter passed with an amount of time from the current point for when the method should be called. An example of the future call is shown below. </p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">methods</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">methodName</span><span class="p-Indicator">:</span> <span class="p-Indicator">|</span>
    <span class="no">if( criteriaMet )</span>
    <span class="no">{</span>
      <span class="no">doSomething();</span>
      <span class="no">this.future( 0.05 ).methodName();</span>
    <span class="no">}</span>
</code></pre></div>
<p>The future call schedules the next step. The parameter passed to the function call can be raised or lowered to smooth or optimize the animation, respectively.</p>

<p>Future calls may also be used for property assignment or to fire an event at a given time in the future.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">future</span><span class="p">.</span><span class="nx">eventName</span><span class="p">();</span>
<span class="k">this</span><span class="p">.</span><span class="nx">future</span><span class="p">.</span><span class="nx">propertyName</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
</code></pre></div>
	
	<h2><a name="html">HTML Overlays</a></h2>

<p>Two dimensional components may be added to any application via HTML. When an application loads, the framework automatically looks for an HTML file of the same name. For instance, if your application is entitled <code><i>application</i>.vwf.yaml</code>, VWF will look for a file in the same directory called <code><i>application</i>.vwf.html</code>. This HTML is of a standard format, and can, in fact, be loaded standalone in a browser. </p>

<p>A few additions to the file can attach the 2D content as an overlay directly over the VWF view, and scripts can be added to attach the HTML content to the application pieces itself. </p>

<hr>

<h3>Overlay HTML Content</h3>

<p>The first step is to create the HTML content as you&#39;d like it to appear on the screen. In the example below, everything contained within the first div can stand alone as it&#39;s own HTML file, with standard css rules applied.</p>
<div class="highlight"><pre><code class="html language-html" data-lang="html"><span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;wrapper&quot;</span> <span class="na">class=</span><span class="s">&quot;wrapper&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;toolstyle&quot;</span> <span class="na">id=</span><span class="s">&quot;toolbar&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;img</span> <span class="na">id=</span><span class="s">&quot;icon1&quot;</span> <span class="na">src=</span><span class="s">&quot;images/icon1.png&quot;</span> <span class="na">style=</span><span class="s">&quot;border:3px solid red&quot;</span> <span class="na">alt=</span><span class="s">&quot;icon1&quot;</span> 
        <span class="na">onclick=</span><span class="s">&quot;setMode(&#39;mode1&#39;)&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;img</span> <span class="na">id=</span><span class="s">&quot;icon2&quot;</span> <span class="na">src=</span><span class="s">&quot;images/icon2.png&quot;</span> <span class="na">style=</span><span class="s">&quot;border:2px solid black&quot;</span> <span class="na">alt=</span><span class="s">&quot;icon2&quot;</span> 
        <span class="na">onclick=</span><span class="s">&quot;setMode(&#39;mode2&#39;)&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span><span class="nt">&gt;</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#wrapper&#39;</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="s1">&#39;#vwf-root&#39;</span><span class="p">);</span>
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>
</code></pre></div>
<p>In order to attach the content as an overlay to the application, we&#39;ve added an additonal script tag, that appends the <code>wrapper</code> div to <code>vwf-root</code>, or the main application view. </p>

<p><strong>Note</strong>: The loader strips out header and body tags and inserts content directly into index.html. HTML5 formatting is helpful for testing as a standalone webpage, but not required for VWF. </p>

<hr>

<h3>Allow HTML to Monitor and Change the Simulation State</h3>

<p>The HTML has access to the VWF application models through <code>vwf_view</code>. Thus, the HTML can watch what happens within the simulation and make changes to it such as setting properties, calling methods, and firing events. </p>

<p>The <code>vwf.api.kernel</code> in the <a href="#system-api">system API</a> contains a full list of possible kernel calls that can be made from the view (.html).</p>

<p>The following sections show examples of how to do just that. Refer to <a href="#querying">querying</a> for more information about obtaining node IDs to pass to the following functions.</p>

<hr>

<h3>Allow HTML to Set Application Properties</h3>

<p>Properties of the application or of specific nodes may be set directly in the javascript of an HTML file. In order to set a property, the following syntax should be used. </p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">vwf_view</span><span class="p">.</span><span class="nx">kernel</span><span class="p">.</span><span class="nx">setProperty</span><span class="p">(</span><span class="nx">vwf_view</span><span class="p">.</span><span class="nx">kernel</span><span class="p">.</span><span class="nx">application</span><span class="p">(),</span> <span class="s2">&quot;property1&quot;</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
</code></pre></div>
<p>The first argument is the ID of the node containing the given property. In this case, the property is on the application itself, and uses the function call for the root node of the application. The second parameter is the name of the property to set, and the third argument is the value to be passed to the specified property. </p>

<hr>

<h3>Allow HTML to Call Application Methods</h3>

<p>Application methods can be called directly from the HTML, with or without parameters. In order to call a method, the following syntax should be used.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">vwf_view</span><span class="p">.</span><span class="nx">kernel</span><span class="p">.</span><span class="nx">callMethod</span><span class="p">(</span><span class="nx">vwf_view</span><span class="p">.</span><span class="nx">kernel</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="kc">undefined</span><span class="p">,</span> <span class="s2">&quot;/nodeName&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;method1&quot;</span><span class="p">);</span>
</code></pre></div>
<p>The first argument is the ID of the node where the method resides. In this case, the ID is found using the <a href="#querying">find</a> function call passing in the name of the node. The second parameter is the name of the method as defined in the main application file. In order to pass parameters directly to the method call, a third parameter may be passed as an array of values. </p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">vwf_view</span><span class="p">.</span><span class="nx">kernel</span><span class="p">.</span><span class="nx">callMethod</span><span class="p">(</span><span class="nx">vwf_view</span><span class="p">.</span><span class="nx">kernel</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="kc">undefined</span><span class="p">,</span> <span class="s2">&quot;/nodeName&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;method1&quot;</span><span class="p">,</span> <span class="p">[</span> <span class="nx">parameter1</span><span class="p">,</span> <span class="nx">parameter2</span><span class="p">,</span> <span class="nx">etc</span> <span class="p">]);</span>
</code></pre></div>
<hr>

<h3>Allow HTML to Create Components</h3>

<p>New components can also be created from the HTML. In order to create a node, the following syntax should be used.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">vwf_view</span><span class="p">.</span><span class="nx">kernel</span><span class="p">.</span><span class="nx">createChild</span><span class="p">(</span><span class="nx">vwf_view</span><span class="p">.</span><span class="nx">kernel</span><span class="p">.</span><span class="nx">application</span><span class="p">(),</span> <span class="s2">&quot;componentName&quot;</span><span class="p">,</span> <span class="nx">component</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
</code></pre></div>
<p>The first argument is the ID of the node that will be the parent of the new component. The second argument is the name of the new component, and the third is the JavaScript object defining the new component. The final argument is optional, and is a function that will be called after the new component has been created.  Note the callback is not
currently functional.</p>

<hr>

<h3>Monitor the Simulation to Manipulate HTML</h3>

<p>HTML can reflect changes to the simulation as they occur. These changes can include property updates, method calls, or event fires. The following example allows the HTML to be notified of property changes in the simulation. </p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">vwf_view</span><span class="p">.</span><span class="nx">satProperty</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">nodeId</span><span class="p">,</span> <span class="nx">propertyName</span><span class="p">,</span> <span class="nx">propertyValue</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">nodeId</span> <span class="o">==</span> <span class="nx">vwf_view</span><span class="p">.</span><span class="nx">kernel</span><span class="p">.</span><span class="nx">application</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="nx">propertyName</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="s2">&quot;mouseMode&quot;</span><span class="o">:</span>
        <span class="nx">doSomething</span><span class="p">(</span> <span class="nx">propertyValue</span> <span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>In this case, any time a property has been set, this function will check to see if the property was changed on a specific node, and if so, will check the name of the property. If found, javascript can then be performed to update the HTML state.</p>

<p>Similarly, the HTML can monitor other types of application updates as well. A few common ones are listed below.</p>

<ul>
<li>Node created - <code>vwf_view.createdNode = function ...</code></li>
<li>Node deleted - <code>vwf_view.deletedNode = function ...</code></li>
<li>Method called - <code>vwf_view.calledMethod = function ...</code></li>
<li>Event fired - <code>vwf_view.firedEvent = function ...</code></li>
</ul>

<p>The <code>vwf.api.view</code> in the <a href="#system-api">system API</a> contains a full list of view driver calls.</p>

	
	<h2><a name="drivers">Drivers</a></h2>

<p>We&#39;ve discussed how to write an application using the framework. The next section describes how the system works, and how to reconfigure the system to accomplish more complex tasks. The drivers of the system are the things that connect components to the 3D visualization and the user interaction that you see. </p>

<p>The drivers define the autonomic actions that happen within a system, dividing responsibility and delegating work for each action of the system. These actions include things such as creating or deleting a node, getting or setting a property, calling methods, and firing events. The drivers stand side by side without direct interaction between them. Rather, they interact by autonomic actions that the kernel manages. </p>

<p>For example, the three.js driver is responsible for any manipulation on the node that&#39;s part of the scene, like setting the translation of a node. This information may be ignored by the rest of the drivers if it is not needed. </p>

<p>Model and view drivers have the same structure; however, the model driver doesn&#39;t reach out, and a view driver does not have direct control. </p>

<h3>Configuring Drivers for an Application</h3>

<p>An application allows for both its model and view drivers to be selected and activated via a configuration file. This system will look for a config file with the same base name as the application being loaded. For instance, <code>application.vwf</code> will search for and attempt to load a config file entitled <code>application.vwf.config.yaml</code>.</p>

<p>Within the configuration, both model and view drivers may be defined within the <code>model:</code> or <code>view:</code> tag, using the path to the driver file, as shown below. </p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="nn">---</span>
<span class="l-Scalar-Plain">model</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">vwf/model/threejs</span><span class="p-Indicator">:</span>
<span class="l-Scalar-Plain">view</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">vwf/view/threejs</span><span class="p-Indicator">:</span> <span class="s">&quot;#vwf-root&quot;</span>
  <span class="l-Scalar-Plain">vwf/view/lesson</span><span class="p-Indicator">:</span> 
</code></pre></div>
<p>For drivers that require parameters, such as the renderer view driver that requires the correct HTML element ID, these can be passed in one of two ways. If there is only one parameter, it can be passed in as shown above to the right of the colon: <code>&quot;#vwf-root&quot;</code>. Alternatively, the parameter name may also be explicitly listed as defined below.</p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="nn">---</span>
<span class="l-Scalar-Plain">view</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">vwf/view/glge</span><span class="p-Indicator">:</span> 
    <span class="l-Scalar-Plain">application-root</span><span class="p-Indicator">:</span> <span class="s">&quot;#vwf-root&quot;</span>
</code></pre></div>
<hr>

<h3>Default Drivers</h3>

<p>By default, the following drivers are active:</p>

<ul>
<li>Threejs (vwf/model/threejs, vwf/view/threejs)</li>
<li>Javascript (vwf/model/javscript)</li>
<li>Object (vwf/model/object)</li>
<li>Document (vwf/view/document)</li>
</ul>

<p>Alternative driver options also include:</p>

<ul>
<li>Editor (vwf/view/editor)</li>
<li>GLGE (vwf/model/glge, vwf/view/glge)</li>
<li>JigLib (vwf/model/jiblib)</li>
<li>Cesium (vwf/model/cesium, vwf/view/cesium)</li>
<li>Google Earth (vwf/view/google-earth)</li>
<li>Lesson (vwf/view/lesson)</li>
<li>WebRTC (vwf/view/webrtc)</li>
</ul>

<p>For 2D applications, or any application where the default drivers are not necessary, the keyword <code>nodriver</code> may be used. For example, in <em>tile-puzzle-2D</em>, a WebGL renderer is not required, and thus uses the following configuration:</p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="nn">---</span>
<span class="l-Scalar-Plain">model</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">nodriver</span><span class="p-Indicator">:</span> 
</code></pre></div>
<hr>

<h3>Additional Information</h3>

<p>In addition to defining the driver configuration for your application, the <code>config.yaml</code> file also allows you to set some additional information: an HTML title for the page. The following example configuration will set the title to the specified value, rather than the default <em>Virtual World Framework.</em></p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="nn">---</span>
<span class="l-Scalar-Plain">info</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">title</span><span class="p-Indicator">:</span> <span class="s">&quot;My</span><span class="nv"> </span><span class="s">New</span><span class="nv"> </span><span class="s">VWF</span><span class="nv"> </span><span class="s">Application&quot;</span>
</code></pre></div>
<hr>

<h3>Passing Configuration Parameters in URL</h3>

<p>An alternative option to using the <code>config.yaml</code> file is to pass in driver parameters via the URL. </p>

<p>For instance, the Google Earth view driver may be loaded in an application without a configuration file:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">https://demo.virtual.wf/earth/#!google-earth
</code></pre></div>
<p>Both a model and a view driver may be loaded in an application with the following URL:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">https://demo.virtual.wf/humvee/?threejs#!threejs
</code></pre></div>
<p>Parameters may also be passed in via the URL. The following example passes in parameters for the application root and setting the pick interval:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">https://demo.virtual.wf/sandtable/?threejs#!threejs={&quot;application-root&quot;:&quot;#vwf-root&quot;,&quot;experimental-pick-interval&quot;:50}
</code></pre></div>
<p><strong>Note</strong>: The URL takes precedence and will override anything defined via the configuration file.</p>

	
	<h2><a name="editor">Editor</a></h2>

<p>The editor capability of VWF allows for the app to be edited in a live environment. It provides full control to the user and has the ability to navigate through the current state of the app, consisting of its various nodes and properties. The editor allows changes to be made to the shared simulation by setting properties, calling methods, and firing events. </p>

<hr>

<h3>Opening the Editor</h3>

<p>The editor is not enabled by default. The app&#39;s config file can be updated to include the editor interface under the <code>view:</code> tag. Additionally, the threejs model and view drivers must be added, as adding just the editor will override the default drivers. An example configuration is below.</p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="nn">---</span>
<span class="l-Scalar-Plain">model</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">vwf/model/threejs</span><span class="p-Indicator">:</span>
<span class="l-Scalar-Plain">view</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">vwf/view/threejs</span><span class="p-Indicator">:</span> <span class="s">&quot;#vwf-root&quot;</span>
  <span class="l-Scalar-Plain">vwf/view/editor</span><span class="p-Indicator">:</span>
</code></pre></div>
<p>Alternatively, the threejs and editor driver parameters can be passed via the URL. For example, the following URL will enable the editor.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">http://hostname.com/app/?threejs#!threejs&amp;editor
</code></pre></div>
<p>The editor interface will now be available within the app. To open, move the mouse to the upper right side of the screen. Upon a mouse rollover, five editor tabs should be displayed. Selecting one will open the editor on the right hand side of the screen, pushing the application view to the left.</p>

<p>The editor consists of five tabs:</p>

<ul>
<li>Application</li>
<li>Users</li>
<li>Time</li>
<li>Models</li>
<li>About</li>
</ul>

<p>To close the editor, rollover just to the left of the upper left corner of the editor. The five tabs will appear as well as an <em>X</em> tab. Click on the <em>X</em> tab to close the editor interface. </p>

<hr>

<h3>Application</h3>

<p>The Application tab displays a list of all children, properties, methods, events, behaviors, and scripts in the application. In addition, this tab provides a drill down capability on selected items, allowing complete navigation of the scene structure. Some items can also be edited directly with text based inputs.</p>

<div style='width:100%;text-align:center'><img src='images/editor_hierarchy.png' alt='hierarchy' /></div>

<h4>Properties</h4>

<p>All properties of a given node can be edited while the application is running. Using the editor interface, drill down into the appropriate node, or find the property in the app&#39;s property list. The property value can simply be edited by entering or changing the value and clicking the <em>Enter</em> key.</p>

<div style='width:100%;text-align:center'><img src='images/editor_properties.png' alt='properties' /></div>

<p>Properties may be booleans, numbers, or strings, and their values are represented in form they would be as a javascript format. Strings must be quoted, and arrays must be entered in the form of <code>[ 0, 0, 0 ]</code>. Values can also be <code>null</code> or </code>undefined</code>.</p>

<h4>Methods</h4>

<p>All methods associated with the current node are listed in the editor. They can be called directly from the main window, if they do not require parameters, by clicking the <em>Call</em> button. If parameters are required for a method, a white arrow will appear by rolling over the right of the <em>Call</em> button. Clicking the white arrow will drill down into the method, and parameters can be specified in the given text fields. The <em>Call</em> button can then be clicked from the header. To go back to the node, select the white back arrow in the upper left corner. </p>

<div style='width:100%;text-align:center'>
<img src='images/editor_method.png' alt='method' />
<img src='images/editor_method_2.png' alt='method' />
</div>

<h4>Events</h4>

<p>All events associated with the current node are listed in the editor. They can be fired directly from the main window, if they do not require parameters, by clicking the <em>Fire</em> button.  If parameters are required for an event, a white arrow will appear by rolling over the right of the <em>Fire</em> button. Clicking the white arrow will drill down into the event, and parameters can be specified in the given text fields. The <em>Fire</em> button can then be clicked from the header. To go back to the node, select the white back arrow in the upper left corner. </p>

<div style='width:100%;text-align:center'>
<img src='images/editor_event.png' alt='event' />
<img src='images/editor_event_2.png' alt='event' />
</div>

<h4>Children</h4>

<p>All children of the current node are listed in the editor, and each can be drilled into to see a level deeper in the tree structure. Each child node is marked with a white arrow to the right of the child&#39;s name. Click on any child in the list in order to drill down. The new node information will be displayed including any scripts, behaviors, properties, children, methods, and events associated with the node. </p>

<div style='width:100%;text-align:center'><img src='images/editor_children.png' alt='children' /></div>

<h4>Behaviors</h4>

<p>Behaviors can be attached to any node in the scene. For all nodes with behaviors, upon drilling into the selected node, a list of all implemented behaviors will be displayed. </p>

<div style='width:100%;text-align:center'><img src='images/editor_behavior.png' alt='behavior' /></div>

<h4>Scripts</h4>

<p>Scripts can be both created and edited in the editor interface. </p>

<div style='width:100%;text-align:center'><img src='images/editor_scripts.png' alt='scripts' /></div>

<p><em>Creating New Script</em></p>

<p>To create a new script on a node in the application hierarchy, click on the <em>New Script</em> item listed first. Click in the text area that appears to give it focus. The editor window will expand to allow more room for typing the script. A new script can be added here that extends an existing function, for example, mouse events, or can be brand new. Once the script is ready to go, click on the <em>Create</em> button at the bottom of the editor. To exit to script editor, either close the editor by selecting the <em>X</em> tab or selecting the back arrow in the upper left corner to drill back up to the node. </p>

<p><em>Editing Script</em></p>

<p>To edit an existing script, click on the corresponding script listed in the editor on the appropriate node. The script editor will open, displaying the current script. Click in the text area to expand the editor working area. Make any updates as needed, and click the <em>Update</em> button at the bottom of the editor. To exit to script editor, either close the editor by selecting the <em>X</em> tab or selecting the back arrow in the upper left corner to drill back up to the node. </p>

<div style='width:100%;text-align:center'><img src='images/editor_script.png' alt='script' /></div>

<hr>

<h3>Users</h3>

<p>The Users tab shows a list of all user IDs currently in the application instance.</p>

<div style='width:100%;text-align:center'><img src='images/editor_users.png' alt='users' /></div>

<hr>

<h3>Time</h3>

<p>The Time tab contains a pause and stop button which, when pressed, will pause and stop the application clock, respectively. In this case, the pause button will change to a play button which will allow the clock to be started again. Additionally, the Timeline tab also allows the clock speed to be adjusted to be faster or slower, depending on where the slider is dragged. The rate will be numerically displayed below in relation to the normal time.</p>

<div style='width:100%;text-align:center'><img src='images/editor_timeline.png' alt='timeline' /></div>

<hr>

<h3>Models</h3>

<p>The Models tab is a listing of assets on the server that are available for dragging into the application, creating new children in the scene. Upon opening the tab, a list of all available models on the server is displayed. Clicking on any of the listed models will drill down into that model, allowing the user to set properties of the node to be created, including the rotation, scale, and translation offset (distance from the drop location). After setting these properties, the user can then drag the <em>Drag to Create</em> area and drop it on any location in the scene. Upon the drop, the new object will be created with the specified properties. </p>

<div style='width:100%;text-align:center'>
<img src='images/editor_models.png' alt='models' />
<img src='images/editor_models_2.png' alt='models' />
</div>

<hr>

<h3>About</h3>

<p>The About tab displays the current version of the VWF used in the app, where the first number describes a major release, the second a minor release, the third a patch, and finally, the revision number of the build. The tab also contains links to the main webpage and github repository for user reference.</p>

<div style='width:100%;text-align:center'><img src='images/editor_about.png' alt='about' /></div>

	
	<h2><a name="querying">Querying</a></h2>

<p>Within VWF, there are several ways to query for a specific node for use in any application script. The <code>this.find</code> function runs a search and returns a set of matching nodes. The <code>this.test</code> function takes in a parameter to test against and returns a boolean value depending on whether the search was successful. </p>

<p>From a component of the application, the function takes in a search criteria parameter and will run a search on the specified component. Thus, if the function is called on the main application, it will search all nodes of the application. The functions may also be called on any other component of the application, and will run a search on all the children of that node. </p>

<p>The remainer of this section will focus on how to use the find and test query functions and provide several examples of various scenarios. </p>

<hr>

<h2>Example Queries</h2>

<h3>On the application level (in the model)</h3>

<p>The following will return any nodes with the specified path. </p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span> <span class="s2">&quot;/radio/bone1/MaxScene/Radio&quot;</span> <span class="p">);</span>
</code></pre></div>
<p>The following will search for all children nodes of the component on which it is called.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span> <span class="s2">&quot;/*&quot;</span> <span class="p">);</span>
</code></pre></div>
<p>This call will execute the function defined for each ID that is returned from the query. </p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span> <span class="s2">&quot;/*&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">id</span> <span class="p">)</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">(</span> <span class="nx">id</span> <span class="p">)</span> <span class="p">)</span> <span class="p">}</span> <span class="p">);</span>
</code></pre></div>
<p>The <em>//</em> represents all children at any level beneath the node upon which the query is called. The following query will return any nodes within the scene matching Radio.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span> <span class="s2">&quot;//Radio&quot;</span> <span class="p">);</span>
</code></pre></div>
<p>The following query will return nodes at any level that have a parent named <em>Radio</em>. </p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span> <span class="s2">&quot;//Radio/*&quot;</span> <span class="p">);</span>
</code></pre></div>
<p>The element keyword can also be used to specify search criteria (note that it is sensitive to white space - do not put spaces in the parameter list).</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span> <span class="s2">&quot;element(dir2)&quot;</span> <span class="p">);</span>
</code></pre></div>
<p>The following query will return descendent nodes of the specified type (again, no spaces in <em>element</em>&#39;s parameter list). </p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span> <span class="s2">&quot;.//element(*,&#39;http://vwf.example.com/light.vwf&#39;)&quot;</span> <span class="p">);</span>
</code></pre></div>
<p>The following query will return all children with <em>name1</em> who have a child with <em>name2</em>.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span> <span class="s2">&quot;name1[name2]&quot;</span> <span class="p">);</span>
</code></pre></div>
<p>The following query will return all children that have at least one child.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span> <span class="s2">&quot;*[*]&quot;</span> <span class="p">);</span>
</code></pre></div>
<p>Properties can also be used in a query. The following query searches for all children of <em>name1</em> that have the given property condition. </p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span> <span class="s2">&quot;name1[@property]&quot;</span> <span class="p">);</span>
</code></pre></div>
<p>To test whether a node with certain criteria exist, use <em>test()</em> with the same parameters as <em>find()</em>. It will return true or false.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span> <span class="s2">&quot;/camera&quot;</span> <span class="p">);</span>
</code></pre></div>
<h3>On the driver level (in the view)</h3>

<p>The driver-level syntax is very similar, with three exceptions:</p>

<ol>
<li><code>find()</code> or <code>test()</code> is called on the view object instead of a node in the scene.</li>
<li>An extra parameter is added to the beginning for the id of the node from which you are searching - this can be <code>undefined</code> for absolute path searches (those that begin with a slash).</li>
<li><code>find()</code> returns an array of ids corresponding to the matched nodes, rather than a reference to the node itself (since at the driver level all access to nodes is done through their ids).</li>
</ol>

<p>For example:</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">matchedIds</span> <span class="o">=</span> <span class="nx">vwf_view</span><span class="p">.</span><span class="nx">kernel</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span> <span class="nx">parentNodeId</span><span class="p">,</span> <span class="s2">&quot;/radio/bone1/MaxScene/Radio&quot;</span> <span class="p">);</span>
<span class="kd">var</span> <span class="nx">nodeExists</span> <span class="o">=</span> <span class="nx">vwf_view</span><span class="p">.</span><span class="nx">kernel</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span> <span class="nx">nodeId</span><span class="p">,</span> <span class="s2">&quot;/*&quot;</span> <span class="p">);</span>
</code></pre></div>
	
	<h1><a name="cookbook">Cookbook</a></h1>

<p>The cookbook is a collection of &quot;recipes&quot; to teach the user how to create some basic functionality within the Virtual World Framework.</p>

	
	<h2><a name="multiuser">Create a Multi-user Application</a></h2>

<p><sup>(Note: This recipe is based on the <a href="https://demo.virtual.wf/demos/multiuser">multiuser example app</a> - check it out for greater context.  You can find the source for the app in the <a href="https://github.com/virtual-world-framework/vwf">github repository</a> in public/web/example/multiuser.)</sup></p>

<p>All that is needed for a VWF app to become a multi-user app is for a second person to navigate to the same url. By default, both users share the same view of the virtual world.</p>

<p>Often, you will want your users to be different &quot;characters&quot; in the scene. For this to happen, we need to set the scene&#39;s <code>usersShareView</code> property to <code>false</code>:</p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://vwf.example.com/scene.vwf</span>
<span class="l-Scalar-Plain">properties</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">usersShareView</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">false</span>
</code></pre></div>
<p>By default, the system will create a camera for each user who joins the application so users can move independently through the scene. Often you will want some represention of each user (an avatar) in your application so users can see each other. To specify the object that we want the system to create for each user, we need to set the scene&#39;s <code>userObject</code> property to a description of the desired object. This userObject must play by two rules:</p>

<ul>
<li>It must implement the <code>navigable</code> behavior to be recognized as something the user can control.</li>
<li>It must contain a camera so the user can see.</li>
</ul>

<p>Here is an example of a user object that is a duck with a camera attached:</p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">userObject</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://vwf.example.com/node3.vwf</span>
  <span class="l-Scalar-Plain">implements</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span> <span class="s">&quot;http://vwf.example.com/navigable.vwf&quot;</span> <span class="p-Indicator">]</span>
  <span class="l-Scalar-Plain">properties</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">translationSpeed</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">10000</span>
  <span class="l-Scalar-Plain">children</span><span class="p-Indicator">:</span>     
    <span class="l-Scalar-Plain">camera</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://vwf.example.com/camera.vwf</span>
      <span class="l-Scalar-Plain">properties</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">translation</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span> <span class="nv">0</span><span class="p-Indicator">,</span> <span class="nv">0</span><span class="p-Indicator">,</span> <span class="nv">800</span> <span class="p-Indicator">]</span>
        <span class="l-Scalar-Plain">far</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">1000000</span>
        <span class="l-Scalar-Plain">near</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">1</span>
    <span class="l-Scalar-Plain">avatar</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://vwf.example.com/node3.vwf</span>
      <span class="l-Scalar-Plain">source</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">models/duck.dae</span>
      <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">model/vnd.collada+xml</span>
      <span class="l-Scalar-Plain">properties</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">rotation</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span> <span class="nv">0</span><span class="p-Indicator">,</span> <span class="nv">0</span><span class="p-Indicator">,</span> <span class="nv">1</span><span class="p-Indicator">,</span> <span class="nv">90</span> <span class="p-Indicator">]</span>
        <span class="l-Scalar-Plain">scale</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">4.5</span>
</code></pre></div>
<p>That&#39;s all!</p>

<h3>Notes</h3>

<ul>
<li>Currently these instructions work with only the three.js renderer (since the functionality is implemented in the VWF drivers for three.js).</li>
<li>Though the <code>userObject</code> property looks like a node description, it is only a property (later, the system will create a node for the user from this property). Therefore, one cannot manipulate <code>userObject</code> by calling methods for node operations (for example, we cannot call <code>userObject.createChild(..)</code>). Once the system creates the actual node, we may call such functions on that node.</li>
</ul>

<h3>Common Pitfalls</h3>

<ul>
<li><p>Do not use <code>this.moniker</code> in the model (.yaml)!</p>

<p><code>this.moniker</code> contains an id that is unique for every user in the application. It might be tempting to make users behave differently by creating conditionals around this variable. However, doing so breaks VWF&#39;s replicated computation since each user&#39;s model then diverges from the others. All user-specific actions need to be on the view side.</p></li>
<li><p>Do not access the <code>vwf</code> variable anywhere.</p>

<p><code>vwf</code> gives a coder direct access to manipulate the model. This may seem convenient, but it side-steps VWF&#39;s mechanisms to ensure that state stays synchronized between users.  In the future this variable will be hidden from us coders for our safety, but in the mean time, steer clear of it!</p></li>
<li><p>For a full list of pitfalls, see the document located <a href="#pitfalls">here</a>.</p></li>
</ul>

	
	<h2><a name="simulation">Create a Simulation</a></h2>

<p>Let&#39;s define a <em>simulation</em> as any application that models a sequence of causes and effects. Here&#39;s how to create one:</p>

<hr>

<h3>Load the 3D scene</h3>

<p>Let&#39;s use the 3D model of a radio that comes with the VWF source in /public/demos/radio:</p>

<p><img src="images/radio.png" alt="The radio 3D model for this recipe"></p>

<p>Let&#39;s load it in our <em>index.vwf.yaml</em> file:</p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="nn">---</span>
<span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://vwf.example.com/scene.vwf</span>
<span class="l-Scalar-Plain">children</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">radio</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://vwf.example.com/node3.vwf</span>
    <span class="l-Scalar-Plain">source</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">radio.DAE</span>
</code></pre></div>
<hr>

<h3>Add a behavior to an object that reacts to user interaction</h3>

<p>A <em>behavior</em> is a component that can be added to another to give it added functionality. Once created, these behaviors can be reused like building blocks, making it faster to create your applications.  Luckily, someone has already written a <em>control</em> behavior that we can reuse. Let&#39;s put it on the volume knob, inside the radio 3D model.</p>

<p>Hold down the <em>Alt</em> key and click anywhere in the scene; the console will print the hierarchy of the scene in both yaml and json format. Copy and paste the yaml into your application document (unfortunately, it will bring the console line numbers with it, but they are all identical, so a string replace can rid you of them easily). Here is a subset of it below with the behavior added to the <code>ic40Volume</code> node:</p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="nn">---</span>
<span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://vwf.example.com/scene.vwf</span>
<span class="l-Scalar-Plain">children</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">radio</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://vwf.example.com/node3.vwf</span>
    <span class="l-Scalar-Plain">source</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">radio.DAE</span>
    <span class="l-Scalar-Plain">children</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">Radio</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://vwf.example.com/node3.vwf</span>
        <span class="l-Scalar-Plain">children</span><span class="p-Indicator">:</span>
          <span class="l-Scalar-Plain">ic40Volume</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://vwf.example.com/node3.vwf</span>
            <span class="l-Scalar-Plain">implements</span><span class="p-Indicator">:</span>
            <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">http://vwf.example.com/control-old.vwf</span>
            <span class="l-Scalar-Plain">properties</span><span class="p-Indicator">:</span>
              <span class="l-Scalar-Plain">rotation</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">0</span><span class="p-Indicator">,</span> <span class="nv">0</span><span class="p-Indicator">,</span> <span class="nv">1</span><span class="p-Indicator">,</span> <span class="nv">0</span><span class="p-Indicator">]</span>
              <span class="l-Scalar-Plain">controlType</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">rotate</span>
              <span class="l-Scalar-Plain">controlMode</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">positions</span>
              <span class="l-Scalar-Plain">transformIncrement</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">12</span>
              <span class="l-Scalar-Plain">transformAxis</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span> <span class="nv">0</span><span class="p-Indicator">,</span> <span class="nv">1</span><span class="p-Indicator">,</span> <span class="nv">0</span> <span class="p-Indicator">]</span>
</code></pre></div>
<hr>

<h3>Add a behavior to another object that reacts to the first</h3>

<p>We need another behavior to turn the screen on when the power switch is clicked. This one we will create ourselves. Let&#39;s create a file called <em>turnon.vwf.yaml</em> and place it in support/proxy/vwf.example.com.  </p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="nn">---</span>
<span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://vwf.example.com/node3.vwf</span>
<span class="l-Scalar-Plain">scripts</span><span class="p-Indicator">:</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">|</span>
  <span class="no">var material = this.glgeObj14.material;</span>

  <span class="no">this.setScreenOn = function( updatedValue ) {</span>
    <span class="no">switch ( updatedValue ) {</span>
      <span class="no">case 0:</span>
        <span class="no">material.texture = &quot;images/lcd.png&quot;; // off</span>
        <span class="no">break;</span>
      <span class="no">default:</span>
        <span class="no">material.texture = &quot;images/LCD_Overall_Glow_On.png&quot;; // on</span>
        <span class="no">break;</span>
    <span class="no">}</span>
  <span class="no">}</span>
</code></pre></div>
<p>Place this behavior on the display screen and add a child to the screen of type material (this is the material specified in the code above, on which we will swap the texture):</p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="nn">---</span>
<span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://vwf.example.com/scene.vwf</span>
<span class="l-Scalar-Plain">children</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">radio</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">...</span>
              <span class="l-Scalar-Plain">Radio</span><span class="p-Indicator">:</span>
                <span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://vwf.example.com/node3.vwf</span>
                <span class="l-Scalar-Plain">children</span><span class="p-Indicator">:</span>
                  <span class="l-Scalar-Plain">ic40Volume</span><span class="p-Indicator">:</span>
                    <span class="l-Scalar-Plain">...</span>
                  <span class="l-Scalar-Plain">LCD</span><span class="p-Indicator">:</span>
                    <span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://vwf.example.com/node3.vwf</span>
                    <span class="l-Scalar-Plain">implements</span><span class="p-Indicator">:</span>
                    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">http://vwf.example.com/turnon.vwf</span>
                    <span class="l-Scalar-Plain">children</span><span class="p-Indicator">:</span>
                      <span class="l-Scalar-Plain">glgeObj14</span><span class="p-Indicator">:</span>
                        <span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://vwf.example.com/mesh.vwf</span>
                        <span class="l-Scalar-Plain">children</span><span class="p-Indicator">:</span>
                          <span class="l-Scalar-Plain">material</span><span class="p-Indicator">:</span>
                            <span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://vwf.example.com/material.vwf</span>
</code></pre></div>
<p>Next, we just need to add a line of code on the Radio that will add the screen&#39;s <code>setScreenOn</code> function as an event handler for the  control&#39;s <code>controlValueUpdated</code> event:</p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="nn">---</span>
<span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://vwf.example.com/scene.vwf</span>
<span class="l-Scalar-Plain">children</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">radio</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">...</span>
              <span class="l-Scalar-Plain">Radio</span><span class="p-Indicator">:</span>
                <span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://vwf.example.com/node3.vwf</span>
                <span class="l-Scalar-Plain">children</span><span class="p-Indicator">:</span>
                  <span class="l-Scalar-Plain">ic40Volume</span><span class="p-Indicator">:</span>
                    <span class="l-Scalar-Plain">...</span>
                  <span class="l-Scalar-Plain">LCD</span><span class="p-Indicator">:</span>
                    <span class="l-Scalar-Plain">...</span>
                    <span class="l-Scalar-Plain">scripts</span><span class="p-Indicator">:</span>
                    <span class="p-Indicator">-</span> <span class="p-Indicator">|</span>
                      <span class="no">this.initialize = function() {</span>
                        <span class="no">this.ic40Volume.controlValueUpdated = this.LCD.setScreenOn();</span>
                      <span class="no">}</span>
</code></pre></div>
<p>Voila!  You have created your very first &quot;simulation&quot;.</p>

<p><strong>Tips:</strong></p>

<ul>
<li>Always be on the lookout for existing components that you can use and save yourself some work.</li>
<li>Consider paying it forward by sharing the components that you create so that others can stand on your shoulders to reach even greater heights.</li>
</ul>

	
	<h2><a name="2d-interface">Create a 2D Interface</a></h2>

<p>You can add two dimensional components to a user&#39;s <em>view</em> via HTML. These components can interact with the <em>model</em> state (update it and be updated from it).</p>

<p>The first step is to create an HTML file that matches the name of your app&#39;s <em>vwf.yaml</em> file.  For example, if your application is titled <em>application.vwf.yaml</em>, create a file in the same directory named <em>application.vwf.html</em>. When your application loads, the framework automatically looks for an HTML file by this name.</p>

<p>Inside that file, you can place any valid HTML, but you must obey two rules:</p>

<ul>
<li>Your HTML must have the style attribute <code>position:absolute</code> to show up in front of the 3D scene. You can achieve this by wrapping everything in a div with that attribute.</li>
<li>Name any css files something <strong>other</strong> than <em>index.css</em>.  VWF uses an <em>index.css</em> file already, and it will ignore yours by that same name.</li>
</ul>

<p><strong>Note</strong>: The loader strips out header and body tags and inserts your content directly into a nameless, classless div in the VWF <em>index.html</em> page (view your app&#39;s page source to see what we mean). Including header and body tags is helpful for testing as a standalone webpage, but not required for VWF. </p>

<p><strong>Note</strong>: The example application <a href="https://demo.virtual.wf/demos/transforms">transforms</a> provides a basic demonstration of the principles described in this recipe. It provides a series of 2D HTML form panels which can be used to set properties, call methods, and receive data from the VWF model. The source for this app can be found in the <a href="https://github.com/virtual-world-framework/vwf">github repository</a> in public/web/example/transforms.)</p>

<hr>

<h3>Monitor and Change the Simulation State</h3>

<p>The view (html) can access the model (yaml) through the <code>vwf_view.kernel</code> object. Thus, the HTML can watch what happens within the simulation and make changes to it such as setting properties, calling methods, and firing events. </p>

<p>The <a href="https://demo.virtual.wf/web/docs/jsdoc/2c8753578a.html">vwf/api/kernel</a> in the <a href="#system-api">system API</a> contains the list of kernel calls that can be made from HTML.</p>

<hr>

<h3>Set Properties</h3>

<p>To set a property on an object, we first find a reference to that object and then set the property.  Like so:</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">nodeId</span> <span class="o">=</span> <span class="nx">vwf_view</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span> <span class="p">...</span> <span class="p">);</span>
<span class="nx">vwf_view</span><span class="p">.</span><span class="nx">kernel</span><span class="p">.</span><span class="nx">setProperty</span><span class="p">(</span> <span class="nx">nodeId</span><span class="p">,</span> <span class="s2">&quot;property1&quot;</span><span class="p">,</span> <span class="nx">value</span> <span class="p">);</span>
</code></pre></div>
<p>Explanations of the parameters can be found in the <a href="#querying">query</a> and <a href="https://demo.virtual.wf/web/docs/jsdoc/2c8753578a.html#setProperty">setProperty</a> documentation. Note that the call to <code>find</code> returns immediately, but <code>setProperty</code> and the other kernel calls in this recipe are asynchronous. You can find out when the property has been set by creating an event handler for the <a href="https://demo.virtual.wf/web/docs/jsdoc/a2d7e1ef81.html#satProperty">satProperty</a> event - and yes... we know that <em>sat</em> is not really the past tense of <em>set</em>.</p>

<hr>

<h3>Call Methods</h3>

<p>To call a model method from the view, we first find a reference to the object (in the same manner as above) and then call the method like so:</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">vwf_view</span><span class="p">.</span><span class="nx">kernel</span><span class="p">.</span><span class="nx">callMethod</span><span class="p">(</span> <span class="nx">nodeId</span><span class="p">,</span> <span class="s2">&quot;method1&quot;</span> <span class="p">);</span>
</code></pre></div>
<p>Pass parameters to the method by passing an array of values as a third parameter: </p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">vwf_view</span><span class="p">.</span><span class="nx">kernel</span><span class="p">.</span><span class="nx">callMethod</span><span class="p">(</span> <span class="nx">nodeId</span><span class="p">,</span> <span class="s2">&quot;method1&quot;</span><span class="p">,</span> <span class="p">[</span> <span class="nx">parameter1</span><span class="p">,</span> <span class="nx">parameter2</span><span class="p">,</span> <span class="nx">etc</span> <span class="p">]</span> <span class="p">);</span>
</code></pre></div>
<p>Explanations of the parameters can be found in the <a href="https://demo.virtual.wf/web/docs/jsdoc/2c8753578a.html#callMethod">callMethod</a>  API description.</p>

<hr>

<h3>Create Components</h3>

<p>Create a model component from the view like so:</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">vwf_view</span><span class="p">.</span><span class="nx">kernel</span><span class="p">.</span><span class="nx">createChild</span><span class="p">(</span> <span class="nx">nodeId</span><span class="p">,</span> <span class="s2">&quot;componentName&quot;</span><span class="p">,</span> <span class="nx">component</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="nx">callback</span> <span class="p">);</span>
</code></pre></div>
<p>Explanations of the parameters can be found in the <a href="https://demo.virtual.wf/web/docs/jsdoc/2c8753578a.html#createChild">createChild</a> API description.</p>

<hr>

<h3>Monitor the Model from HTML</h3>

<p>The HTML can reflect changes to the simulation such as property updates, method calls, or events. The following example enables the HTML to catch property changes in the application. </p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">vwf_view</span><span class="p">.</span><span class="nx">satProperty</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">nodeId</span><span class="p">,</span> <span class="nx">propertyName</span><span class="p">,</span> <span class="nx">propertyValue</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span> <span class="nx">nodeId</span> <span class="o">==</span> <span class="nx">someSpecificNodeId</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span> <span class="nx">propertyName</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="s2">&quot;mouseMode&quot;</span><span class="o">:</span>
        <span class="nx">doSomething</span><span class="p">(</span> <span class="nx">propertyValue</span> <span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>In this case, any time a property has been set, this function will check to see if the property was changed on a specific node, and if so, will check the name of the property. If it is the property we are looking for, we can write javascript to update the HTML state.</p>

<p>Similarly, the view (.html) can monitor other application updates, such as those listed below:</p>

<ul>
<li>Method called - <code>vwf_view.calledMethod = function ...</code></li>
<li>Event fired - <code>vwf_view.firedEvent = function ...</code></li>
<li>Node created - <code>vwf_view.createdNode = function ...</code></li>
<li>Node deleted - <code>vwf_view.deletedNode = function ...</code></li>
</ul>

<p>To learn more about these events, you can look at the System API for the <a href="https://demo.virtual.wf/web/docs/jsdoc/a2d7e1ef81.html">view</a>. Earlier we mentioned that calls to set a property and call a method are asynchronous. If you would like to know when the action has completed, you may do so in <a href="https://demo.virtual.wf/web/docs/jsdoc/a2d7e1ef81.html#satProperty">satProperty</a>/<a href="https://demo.virtual.wf/web/docs/jsdoc/a2d7e1ef81.html#calledMethod">calledMethod</a>/etc.  However, remember that you will get calls into those event handlers for every property/method/etc that is set/called/etc.</p>

<p><strong>Note</strong>: If a property setter alters the incoming value before storing it, <a href="https://demo.virtual.wf/web/docs/jsdoc/a2d7e1ef81.html#satProperty">satProperty</a> will notify the app of the transformed value that is stored, not the original value. See the API description of <a href="https://demo.virtual.wf/web/docs/jsdoc_cmp/symbols/node.vwf.html">node</a> for more details.</p>

<hr>

<h3>Change the Application Title and Favicon</h3>

<p>The default browser title for a VWF application is <em>Virtual World Framework</em>. The title may be specified in an app&#39;s configuration file as shown below. </p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="nn">---</span>
<span class="l-Scalar-Plain">info</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">title</span><span class="p-Indicator">:</span> <span class="s">&quot;Name</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">Application&quot;</span>
</code></pre></div>
<p>Additionally, the favicon of an application may be set simply by dropping a <em>favicon.ico</em> file into the application folder. </p>

<p>For an example of setting these items, visit the <a href="https://demo.virtual.wf/demos/duck">duck application</a>.</p>

	
	<h2><a name="materials">Switch Materials on an Object</a></h2>

<p>Imagine you have a simple scene (a cube) and you would like to programatically change the material on the cube.  (<strong>Note</strong>: it is important that the collada file for the 3D object have properly mapped texture coordinates)</p>

<p>Let&#39;s look at the code for the simple scene, with a material object added as a child to the cube:</p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="nn">---</span> 
<span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://vwf.example.com/scene.vwf</span>
<span class="l-Scalar-Plain">properties</span><span class="p-Indicator">:</span>
<span class="l-Scalar-Plain">children</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">cube</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">node3.vwf</span>
    <span class="l-Scalar-Plain">source</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">cube.dae</span>
    <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">model/vnd.collada+xml</span>
    <span class="l-Scalar-Plain">children</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">material</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://vwf.example.com/material.vwf</span>
<span class="l-Scalar-Plain">scripts</span><span class="p-Indicator">:</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">|</span>
    <span class="no">this.initialize = function() {</span>
    <span class="no">}</span>
</code></pre></div>
<p>You can change the cube&#39;s material anywhere in the code that you would like.  For the purpose of this example, let&#39;s assume that you want to change it right at the beginning in the <code>initialize</code> function.  Everything you could want to change about the material can actually be changed via the properties of the existing material:</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">initialize</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">material</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">cube</span><span class="p">.</span><span class="nx">material</span><span class="p">;</span>

    <span class="c1">// Change the color</span>
    <span class="nx">material</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">205</span> <span class="p">];</span>

    <span class="c1">// Change the texture</span>
    <span class="nx">material</span><span class="p">.</span><span class="nx">texture</span> <span class="o">=</span> <span class="s2">&quot;images/grandma.png&quot;</span><span class="p">;</span>

    <span class="c1">// Make the object transparent</span>
    <span class="nx">material</span><span class="p">.</span><span class="nx">alpha</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>A full list of material properties can be found in the <a href="https://demo.virtual.wf/web/docs/jsdoc_cmp/symbols/material.vwf.html">material</a> application API.</p>

<p>Sometimes it may be desirable to switch out the entire material - if for example, you wanted to toggle between two that had many distinct properties or have more than one object share the same material.  Here&#39;s how you could do that:</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">initialize</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span> <span class="s2">&quot;material1&quot;</span><span class="p">,</span> <span class="s2">&quot;http://vwf.example.com/material.vwf&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">205</span> <span class="p">];</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">texture</span> <span class="o">=</span> <span class="s2">&quot;images/grandma.png&quot;</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">alpha</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">cube</span><span class="p">.</span><span class="nx">material</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">material1</span><span class="p">;</span>
    <span class="p">}</span> <span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
	
	<h2><a name="chat">Add Chat to Your Application</a></h2>

<p>Often for multi-user applications, it is useful to have text-based communication among all users. In VWF, the model and the HTML view need to be integrated through the use of methods and/or events. </p>

<p>For a basic chat feature within a VWF application, define a method or event within the model. Setup the HTML view to call that method with the appropriate parameters (i.e. who is sending the message and the actual text of the message). The view will also need an event listener to capture these parameters. When one client calls <code>sendChat</code>, the model will then call the method, and each view will pick up the parameters from the associated listener. </p>

<hr>

<h3>Additions to the Model</h3>

<p>The application model first needs a method to allow one user to send out a chat message to everyone in the application. The view can then listen for the method call and update the HTML chat view accordingly. The code below shows a sample method definition in yaml.</p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">methods</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">sendChat</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">parameters</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">player</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">message</span>
</code></pre></div>
<hr>

<h3>Additions to the HTML View</h3>

<p>Begin by adding a section to the HTML to capture a chat conversation and an input field for new messages. Here we&#39;ll use a <em>div</em> to display the conversation text and a <em>textarea</em> to capture new chat messages. These two tags are then wrapped in a containing <em>div</em> for easy css styling. </p>
<div class="highlight"><pre><code class="html language-html" data-lang="html"><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;chatWindow&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;chatContent&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
  <span class="nt">&lt;textarea</span> <span class="na">id=</span><span class="s">&quot;chatInput&quot;</span> <span class="na">rows=</span><span class="s">&quot;1&quot;</span> <span class="na">style=</span><span class="s">&quot;width:100%&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>
<p>In the view side JavaScript, we&#39;ll need a way to track which client is represented by the view (so that when a message is sent, all clients will know who sent it). In this example, we&#39;ll create a variable playerName to store this information. Because this is defined in the view, it will be unique to each client in the application. This field can be populated by either a login input screen or upon creation of the player node. Visit the <a href="#multiuser">multi-user recipe</a> for more information. </p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">playerName</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#playerNameInput&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">();;</span>
</code></pre></div>
<p>Next, setup a jQuery listener for the chat <em>textarea</em> input field. Set a keydown listener for the <em>Enter</em> key to trigger the sendChat method, by passing in the following: the scene node, where the method is defined, the name of the method to call, and the method parameters - the value of the <code>playerName</code> field defined above, and the current value of the <code>chatInput</code> <em>textarea</em>. Additionally, set a keyup listener to clear the <em>textarea</em> upon sending, so it&#39;s ready for the next chat message. </p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#chatInput&#39;</span><span class="p">).</span><span class="nx">keydown</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">e</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">code</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">?</span> <span class="nx">e</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">which</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">code</span> <span class="o">==</span> <span class="mi">13</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//Enter</span>
    <span class="nx">vwf_view</span><span class="p">.</span><span class="nx">kernel</span><span class="p">.</span><span class="nx">callMethod</span><span class="p">(</span> <span class="nx">sceneNode</span><span class="p">,</span> <span class="s2">&quot;sendChat&quot;</span><span class="p">,</span> <span class="p">[</span> <span class="nx">playerName</span><span class="p">,</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span> <span class="p">]);</span>
  <span class="p">}</span>
<span class="p">}).</span><span class="nx">keyup</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">e</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">code</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">?</span> <span class="nx">e</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">which</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">code</span> <span class="o">==</span> <span class="mi">13</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//Enter</span>
    <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<p>Finally, setup a VWF method listener in the view, so that each client in the application can respond to the <code>sendChat</code> method call. </p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">vwf_view</span><span class="p">.</span><span class="nx">calledMethod</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">nodeId</span><span class="p">,</span> <span class="nx">methodName</span><span class="p">,</span> <span class="nx">methodParameters</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">nodeId</span> <span class="o">==</span> <span class="nx">sceneNode</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="nx">methodName</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="s2">&quot;sendChat&quot;</span><span class="o">:</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#chatContent&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span> <span class="s2">&quot;&lt;span&gt;&lt;b&gt;&quot;</span> <span class="o">+</span> <span class="nx">methodParameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="nx">methodParameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&lt;/b&gt;&lt;br/&gt;&lt;/span&gt;&quot;</span> <span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Essentially this listener will add the chat message to the <code>chatContent</code> <em>div</em> created above. </p>

	
	<h2><a name="sound">Add Sound Effects to Your Application</a></h2>

<p>For any interactive app, you may want to add sound, either for effect or to notify all users that something has occurred (e.g. a laser was fired, a message has been sent, etc). As with much of the framework, we can accomplish simple sound effects through the use of HTML5&#39;s native features. </p>

<p>A method or event within the app&#39;s model may be used to play a synchronized sound effect by setting up a VWF listener in the HTML view that will play the sound whenever a specific method is called or an event is fired.</p>

<hr>

<h3>Define the Sound Source</h3>

<p>HTML5 allows one to specify sound through the use of the <em>audio</em> tag. The audio tag simply contains a source which specifies the file location of a sound effect. This audio tag will need to be added to the application&#39;s HTML. </p>
<div class="highlight"><pre><code class="html language-html" data-lang="html"><span class="nt">&lt;audio</span> <span class="na">id=</span><span class="s">&#39;exampleAudio&#39;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;source</span> <span class="na">src=</span><span class="s">&quot;sounds/example.wav&quot;</span><span class="nt">&gt;&lt;/source&gt;</span>
<span class="nt">&lt;/audio&gt;</span>
</code></pre></div>
<hr>

<h3>Additions to the Model</h3>

<p>Within the model, define a method or event. This method can either be completely separate, used solely to play a sound, or attached to another method or event, so that a sound is played in conjunction with another action. </p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">methods</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">playSound</span><span class="p-Indicator">:</span>
</code></pre></div>
<hr>

<h3>Additions to the View</h3>

<p>In addition to defining the sound source using the HTML5 native audio tag, set up a listener for the method call. </p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">vwf_view</span><span class="p">.</span><span class="nx">calledMethod</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">nodeId</span><span class="p">,</span> <span class="nx">methodName</span><span class="p">,</span> <span class="nx">methodParameters</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">nodeId</span> <span class="o">==</span> <span class="nx">sceneNode</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="nx">methodName</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="s2">&quot;playSound&quot;</span><span class="o">:</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#exampleAudio&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">play</span><span class="p">();</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Each time the <code>playSound</code> method is called, each client will hear the <code>exampleAudio</code> sound bite.</p>

	
	<h2><a name="transforms">Complex Transforms</a></h2>

<p>Among the most common properties to set on a node within VWF are various transforms. The <a href="https://demo.virtual.wf/web/docs/jsdoc_cmp/symbols/node3.vwf.html">node3</a> component defines the basic transforms including the following:</p>

<ul>
<li><code>worldTransform</code></li>
<li><code>transform</code></li>
<li><code>translation</code> </li>
<li><code>rotation</code></li>
<li><code>quaternion</code></li>
<li><code>scale</code></li>
</ul>

<p>These properties may be used to either initially set the property on application load, or to specifically set a value as a result of an action or event. Directly setting these properties are most useful in simple cases, when the proper values to pass in are known.</p>

<p>Transform property values may be set directly in the property definition, as shown below.</p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">properties</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">rotation</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span> <span class="nv">1</span><span class="p-Indicator">,</span> <span class="nv">0</span><span class="p-Indicator">,</span> <span class="nv">0</span><span class="p-Indicator">,</span> <span class="nv">90</span> <span class="p-Indicator">]</span>
  <span class="l-Scalar-Plain">scale</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">10</span>
</code></pre></div>
<p>Additionally, property values can be set within script, as shown below. </p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">transform</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1</span> <span class="p">];</span>
<span class="k">this</span><span class="p">.</span><span class="nx">translation</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">0</span> <span class="p">];</span>
<span class="k">this</span><span class="p">.</span><span class="nx">scale</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">];</span>
</code></pre></div>
<p><strong>Note</strong>: There is an example app called <a href="https://demo.virtual.wf/demos/transforms">transforms</a>. This application allows the user to set and view the various properties discussed in this recipe, and see the outcome on an actual model. The source for this app can be found in the <a href="https://github.com/virtual-world-framework/vwf">github repository</a> in public/web/example/transforms.) </p>

<hr>

<h3>Transform By Methods</h3>

<p>Alternatively, the <em>node3</em> component defines several methods to aid in more complex transformations of 3D objects in the scene. The following methods are available to combine various transforms on top of each other. Such methods include:</p>

<ul>
<li><code>translateBy</code></li>
<li><code>rotateBy</code></li>
<li><code>quaterniateBy</code></li>
<li><code>scaleBy</code></li>
</ul>

<p>Each of these methods takes in an array transform (or scalar value in the case of <code>scaleBy</code>) to combine with the existing transform on the node. Additionally, these methods will take an optional value <code>duration</code> to perform the transform over time. </p>

<p>Example from the model:</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">objectNode</span><span class="p">.</span><span class="nx">rotateTo</span><span class="p">(</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">45</span> <span class="p">],</span> <span class="mi">10</span> <span class="p">);</span>
</code></pre></div>
<p>Example from the view:</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">vwf_view</span><span class="p">.</span><span class="nx">kernel</span><span class="p">.</span><span class="nx">callMethod</span><span class="p">(</span> <span class="nx">objectNode</span><span class="p">,</span> <span class="s2">&quot;rotateTo&quot;</span><span class="p">,</span> <span class="p">[</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">45</span> <span class="p">],</span> <span class="mi">10</span> <span class="p">]</span> <span class="p">);</span>
</code></pre></div>
<p>The above method calls will rotate objectNode 45 degrees around the z-axis, over a duration of 10 milliseconds. </p>

<hr>

<h3>Transform To Methods</h3>

<p>Another option for transforming an object over time is the <code>transformTo</code> methods. These methods will take in an array or scalar value in the same format as in the property definition itself. However, unlike setting the property directly, use of these methods allow for an optional <code>duration</code> to animate a node&#39;s transformation. </p>

<ul>
<li><code>translateTo</code></li>
<li><code>rotateTo</code></li>
<li><code>quaterniateTo</code></li>
<li><code>scaleTo</code></li>
<li><code>transformTo</code></li>
</ul>

<p>Example from the model:</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">camera</span><span class="p">.</span><span class="nx">translateTo</span><span class="p">(</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span> <span class="p">],</span> <span class="mi">10</span> <span class="p">);</span>
</code></pre></div>
<p>Example from the view:</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">vwf_view</span><span class="p">.</span><span class="nx">kernel</span><span class="p">.</span><span class="nx">callMethod</span><span class="p">(</span> <span class="nx">camera</span><span class="p">,</span> <span class="s2">&quot;translateTo&quot;</span><span class="p">,</span> <span class="p">[</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span> <span class="p">],</span> <span class="mi">10</span> <span class="p">]</span> <span class="p">);</span>
</code></pre></div>
<p>The above method calls will translate the camera to [ 0, 0, 5 ], over a duration of 10 milliseconds. </p>

<hr>

<h3>Closure Library</h3>

<p>Another alternative for complex transformations is simply to use the <code>transform</code> property or the <code>transformTo</code> method in conjuction with complex matrix math. Both of these options require a 16 value array, representing the transform matrix. Vector arrays may also be calculated and used with the individual transform properties and methods. Any combination of transformations can be calculated using matrix math and the vector classes of the <a href="https://developers.google.com/closure/library/">Google Closure Library</a>, which has been integrated into the framework. </p>

<p>The following are some examples of the closure library in action. There are several vector and matrix operations that can be used to calculate a vector and/or matrix to assign to the transform properties or passed to the transform methods.</p>

<p>The functions below will create a new vector or matrix. </p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">newVector</span> <span class="o">=</span> <span class="nx">goog</span><span class="p">.</span><span class="nx">vec</span><span class="p">.</span><span class="nx">Vec3</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">newMatrix</span> <span class="o">=</span> <span class="nx">goog</span><span class="p">.</span><span class="nx">vec</span><span class="p">.</span><span class="nx">Mat4</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>

<span class="nx">newVector</span> <span class="o">=</span> <span class="nx">goog</span><span class="p">.</span><span class="nx">vec</span><span class="p">.</span><span class="nx">Vec3</span><span class="p">.</span><span class="nx">createFromArray</span><span class="p">(</span> <span class="p">[</span> <span class="nx">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">value</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">value</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="nx">newValue</span> <span class="p">]</span> <span class="p">);</span>
</code></pre></div>
<p>Below are examples of using the closure library to perform operations on vectors and matrices, and assigning them to a variable or directly to a transform. </p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">newMat</span> <span class="o">=</span> <span class="nx">goog</span><span class="p">.</span><span class="nx">vec</span><span class="p">.</span><span class="nx">Mat4</span><span class="p">.</span><span class="nx">multMat</span><span class="p">(</span> <span class="nx">mat1</span><span class="p">,</span> <span class="nx">mat2</span><span class="p">,</span>
  <span class="nx">goog</span><span class="p">.</span><span class="nx">vec</span><span class="p">.</span><span class="nx">Mat4</span><span class="p">.</span><span class="nx">create</span><span class="p">()</span>
<span class="p">);</span>

<span class="kd">var</span> <span class="nx">trans</span> <span class="o">=</span> <span class="nx">goog</span><span class="p">.</span><span class="nx">vec</span><span class="p">.</span><span class="nx">Vec3</span><span class="p">.</span><span class="nx">scale</span><span class="p">(</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">directionVector</span><span class="p">,</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">distance</span><span class="p">,</span>
  <span class="nx">goog</span><span class="p">.</span><span class="nx">vec</span><span class="p">.</span><span class="nx">Vec3</span><span class="p">.</span><span class="nx">create</span><span class="p">()</span>
<span class="p">);</span>

<span class="k">this</span><span class="p">.</span><span class="nx">camera</span><span class="p">.</span><span class="nx">translation</span> <span class="o">=</span> <span class="nx">goog</span><span class="p">.</span><span class="nx">vec</span><span class="p">.</span><span class="nx">Vec3</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">camera</span><span class="p">.</span><span class="nx">translation</span><span class="p">,</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">translationToAdd</span><span class="p">,</span>
  <span class="nx">goog</span><span class="p">.</span><span class="nx">vec</span><span class="p">.</span><span class="nx">Vec3</span><span class="p">.</span><span class="nx">create</span><span class="p">()</span>
<span class="p">);</span>
</code></pre></div>
<p>Finally, here are few more examples to do matrix operations such as normalization, transposition, inversion, and quaternions. </p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">goog</span><span class="p">.</span><span class="nx">vec</span><span class="p">.</span><span class="nx">Vec3</span><span class="p">.</span><span class="nx">normalize</span><span class="p">(</span> <span class="nx">v1</span><span class="p">,</span> <span class="nx">normalizedV1</span> <span class="p">);</span>

<span class="nx">goog</span><span class="p">.</span><span class="nx">vec</span><span class="p">.</span><span class="nx">Mat4</span><span class="p">.</span><span class="nx">transpose</span><span class="p">(</span> <span class="nx">example</span><span class="p">,</span> <span class="nx">exampleTranspose</span> <span class="p">);</span> 

<span class="nx">goog</span><span class="p">.</span><span class="nx">vec</span><span class="p">.</span><span class="nx">Mat4</span><span class="p">.</span><span class="nx">invert</span><span class="p">(</span> <span class="nx">example</span><span class="p">,</span> <span class="nx">exampleInverse</span> <span class="p">);</span>

<span class="nx">goog</span><span class="p">.</span><span class="nx">vec</span><span class="p">.</span><span class="nx">Quaternion</span><span class="p">.</span><span class="nx">createFromValues</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
</code></pre></div>
	
	<h2><a name="lesson">Add Training Instruction</a></h2>

<p>One purpose of using VWF is to create a lesson app, with the intent of teaching a user how to accomplish a series of tasks, or steps in a process. </p>

<p>We&#39;ll start with the simplest form of a lesson - one with a single correct path. This means there is only one sequence of steps in the lesson, and no choice of which step to take next.</p>

<hr>

<h3>The Task Component</h3>

<p>At every step, the lesson will issue a task to the student. The sequence of tasks will form the building blocks of the lesson. The <a href="https://demo.virtual.wf/web/docs/jsdoc_cmp/symbols/lesson.task.vwf.html">task component</a> serves as the prototype for lesson tasks, and may be used for each required lesson step. </p>

<p>The task component contains the following properties that can be set in the lesson model file:</p>

<ul>
<li><code>text</code>: Text to display to the user to explain the task</li>
<li><code>cameraPoseRef</code>: Search string used to find a node3 that represents the transform to which the camera will move at the beginning of this task</li>
<li><code>scenePath</code>: xpath reference to the top node of the scene to which the lesson listens for task completion events</li>
<li><code>taskIndex</code>: Index of the currently active subtask; used internally and does not need to be explicitly set in the application</li>
</ul>

<p>In the following example, we&#39;ll focus on the <code>text</code> and <code>cameraPoseRef</code> properties. </p>

<p>The task component also consists of the following methods and events:</p>

<p>Methods:</p>

<ul>
<li><code>enter</code></li>
<li><code>next</code></li>
<li><code>exit</code></li>
</ul>

<p>Events:</p>

<ul>
<li><code>entering</code></li>
<li><code>completed</code></li>
<li><code>exiting</code></li>
</ul>

<p>We can use the events defined above to add steps to the event handlers for each task. For instance, the <code>entering</code> event is in most cases the best place to define the success event, or the step required to complete the task (i.e. fire the <code>completed</code> event), as stated in the text property.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">entering</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="nx">appObject</span><span class="p">.</span><span class="nx">pointerClick</span> <span class="o">=</span> <span class="nx">appObject</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">appObject</span><span class="p">.</span><span class="nx">pointerClick</span> <span class="o">=</span> <span class="nx">appObject</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">flush</span><span class="p">(</span> <span class="k">this</span> <span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">completed</span><span class="p">();</span>
  <span class="p">},</span> <span class="k">this</span> <span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<hr>

<h3>Setting Up Lesson Structure in the Model</h3>

<p>One can turn a VWF application into an instructional lesson by adding a task hierarchy to the model, using the <code>task</code> component type, described above.</p>

<p>First we&#39;ll need to add an overall lesson task as a child of the application. </p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="nn">---</span> 
<span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://vwf.example.com/scene.vwf</span>
<span class="l-Scalar-Plain">children</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">lesson</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://vwf.example.com/lesson/task.vwf</span>
    <span class="l-Scalar-Plain">properties</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">scenePath</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/</span>
</code></pre></div>
<p>Subtasks of the lesson can then be defined as children of the lesson component. Here the <code>text</code> and <code>cameraPosRef</code> are set, and the <code>entering</code> event is used to define the success event - where clicking on the app object flushes the click event and calls the completed event for the step. </p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">children</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">step1</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://vwf.example.com/lesson/task.vwf</span>
    <span class="l-Scalar-Plain">properties</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">text</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">First, do the first task.</span>
      <span class="l-Scalar-Plain">cameraPoseRef</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/cameraPose1</span>
    <span class="l-Scalar-Plain">scripts</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="p-Indicator">|</span>
      <span class="no">this.entering = function() {</span>
        <span class="no">this.logger.info( &quot;Step 1 entering&quot; );</span>
        <span class="no">var self = this;</span>
        <span class="no">var appObject = this.find( &quot;/applicationObject&quot; )[ 0 ];</span>
        <span class="no">appObject.pointerClick = appObject.events.add( function() {</span>
          <span class="no">appObject.pointerClick = appObject.events.flush( this );</span>
          <span class="no">this.logger.info( &quot;Step 1 completed&quot; );</span>
          <span class="no">self.completed();</span>
        <span class="no">}, this );</span>
      <span class="no">} //@ sourceURL=step1.entering</span>
      <span class="no">this.exiting = function() {</span>
        <span class="no">this.logger.info( &quot;Step 1 exiting&quot; );</span>
      <span class="no">} //@ sourceURL=step1.exiting</span>
</code></pre></div>
<p>The overall lesson entering script can also be defined, as needed.</p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml">    <span class="l-Scalar-Plain">scripts</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="p-Indicator">|</span>
      <span class="no">this.entering = function() {</span>
        <span class="no">this.logger.info( &quot;Lesson entering&quot; );</span>
      <span class="no">} //@ sourceURL=lesson.entering</span>
      <span class="no">this.exiting = function() {</span>
        <span class="no">this.logger.info( &quot;Lesson exiting&quot; );</span>
      <span class="no">} //@ sourceURL=lesson.exiting</span>
</code></pre></div>
<p>Additionally, the cameraPoses referenced in the task properties each need to be defined. These represent the transform to which the camera will move at the beginning of the task.</p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml">  <span class="l-Scalar-Plain">cameraPose1</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://vwf.example.com/node3.vwf</span>
    <span class="l-Scalar-Plain">properties</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">translation</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span> <span class="nv">0</span><span class="p-Indicator">,</span> <span class="nv">0</span><span class="p-Indicator">,</span> <span class="nv">0</span> <span class="p-Indicator">]</span>
      <span class="l-Scalar-Plain">rotation</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span> <span class="nv">1</span><span class="p-Indicator">,</span> <span class="nv">0</span><span class="p-Indicator">,</span> <span class="nv">0</span><span class="p-Indicator">,</span> <span class="nv">0</span> <span class="p-Indicator">]</span>
</code></pre></div>
<p>Thus the complete lesson hierarchy is defined in the VWF model, including all lesson tasks, their cameraPoses, and their entering and exit methods. </p>

<h4>Multiple Levels</h4>

<p>For more complex lessons, define tasks with a structure that is more than one level deep. These levels of tasking can be used for tasks that consist of multiple actions, or for those requiring additional instructions in order to complete. </p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">lesson</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://vwf.example.com/lesson/task.vwf</span>
  <span class="l-Scalar-Plain">properties</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">scenePath</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/</span>
  <span class="l-Scalar-Plain">children</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">step_1</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://vwf.example.com/lesson/task.vwf</span>
      <span class="l-Scalar-Plain">properties</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">text</span><span class="p-Indicator">:</span> <span class="s">&quot;1.0&quot;</span>
        <span class="l-Scalar-Plain">cameraPoseRef</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/lesson/cameraPose1</span>
      <span class="l-Scalar-Plain">children</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">step_1_1</span><span class="p-Indicator">:</span>
          <span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://vwf.example.com/lesson/task.vwf</span>
          <span class="l-Scalar-Plain">properties</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">text</span><span class="p-Indicator">:</span> <span class="s">&quot;1.1&quot;</span>
          <span class="l-Scalar-Plain">children</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">step_1_1_1</span><span class="p-Indicator">:</span>
              <span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://vwf.example.com/lesson/task.vwf</span>
              <span class="l-Scalar-Plain">properties</span><span class="p-Indicator">:</span>
                <span class="l-Scalar-Plain">text</span><span class="p-Indicator">:</span> <span class="s">&quot;1.1.1&quot;</span>
              <span class="l-Scalar-Plain">scripts</span><span class="p-Indicator">:</span>
              <span class="p-Indicator">-</span> <span class="p-Indicator">|</span>
                <span class="no">this.entering = function() {</span>
                  <span class="no">this.logger.info( &quot;Step: 1.1.1&quot; );</span>
                <span class="no">}</span>
        <span class="l-Scalar-Plain">step_1_2</span><span class="p-Indicator">:</span>
          <span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://vwf.example.com/lesson/task.vwf</span>
          <span class="l-Scalar-Plain">properties</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">text</span><span class="p-Indicator">:</span> <span class="s">&quot;1.2&quot;</span>
          <span class="l-Scalar-Plain">children</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">step_1_2_1</span><span class="p-Indicator">:</span>
              <span class="l-Scalar-Plain">extends</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://vwf.example.com/lesson/task.vwf</span>
              <span class="l-Scalar-Plain">properties</span><span class="p-Indicator">:</span>
                <span class="l-Scalar-Plain">text</span><span class="p-Indicator">:</span> <span class="s">&quot;1.2.1&quot;</span>
              <span class="l-Scalar-Plain">scripts</span><span class="p-Indicator">:</span>
              <span class="p-Indicator">-</span> <span class="p-Indicator">|</span>
                <span class="no">this.entering = function() {</span>
                  <span class="no">this.logger.info( &quot;Step: 1.2.1&quot; );</span>
                <span class="no">}</span>
</code></pre></div>
<p>The standard lesson interface view driver, described below, supports multiple levels automatically. The figure below shows an example lesson with three levels of tasks in the hierarchy below the overall lesson task. Any additional levels will be appended to the innermost content section. </p>

<div style='width:100%;text-align:center'><img src='images/lesson.png' alt='hierarchy' /></div>

<hr>

<h3>Add Lesson Interface to the View</h3>

<p>The user interface for the lesson will mainly be defined in the app using the lesson view driver. The primary interface for a lesson will consist of the instructional text for each lesson step, a bar to show overall lesson progress, and navigation buttons to start, complete, and skip over lesson tasks.</p>

<p>In order to pull in the lesson view driver (defined in <em>support/client/lib/vwf/view/lesson.js</em>), we simply need to create a configuration file for the application and activate the lesson view.</p>

<p>The configuration file will have the same name as the model file, with the addition of a <em>.config</em>. For instance, if your model file is entited <em>index.vwf.yaml</em>, the configuration file will be titled <em>index.vwf.config.yaml</em>. </p>

<p>The contents of the file will look as follows:</p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="nn">---</span>
<span class="l-Scalar-Plain">model</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">vwf/model/threejs</span><span class="p-Indicator">:</span>
<span class="l-Scalar-Plain">view</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">vwf/view/threejs</span><span class="p-Indicator">:</span> <span class="s">&quot;#vwf-root&quot;</span>
  <span class="l-Scalar-Plain">vwf/view/lesson</span><span class="p-Indicator">:</span> 
</code></pre></div>
<p>This configuration sets the renderer to use the threejs model and view driver in addition to the lesson view driver. </p>

<p>By activating the lesson driver, the app&#39;s user interface will automatically be updated to autogenerate an instruction panel upon lesson start. This instruction panel will pull in the <code>text</code> properties defined in the task components in the model. Additionally, the instruction panel will update based on <code>entering</code> and <code>completed</code> events fired in order to show the current step and progress of the overall lesson. </p>

<p>Visit the <a href="https://demo.virtual.wf/demos/humvee-lesson">humvee lesson</a> to view the final result.</p>

	
	<h2><a name="logging">Logging and Debugging</a></h2>

<p>As you&#39;re building applications in the framework, it often helps to be familiar with the different logging and debugging tools available, both built into the browser as well as in the framwework. </p>

<hr>

<h3>Logging</h3>

<h4>VWF Logging</h4>

<p>The logging levels are defined in <em>support/client/lib/logger.js</em>, documented under <a href="https://demo.virtual.wf/web/docs/jsdoc/module-logger.html">logger</a> in the <a href="#system-api">system API</a>. The logging options are <code>TRACE</code>, <code>DEBUG</code>, <code>INFO</code>, <code>WARN</code>, and <code>ERROR</code>. This module requires the configuration module, defined in <em>support/client/lib/vwf/configuration.js</em>. The default log level on a development server is <code>INFO</code> and the default log level on a production server is <code>WARN</code>. These values can be updated in the configuration.js file. </p>

<p>Logging is preferred over generic console output (e.g. <code>console.error</code>), as console output can cause the browser to crash if proper debugging tools are not installed. </p>

<p>The loggers can be used throughout the framework and have a knowledge of their context, or the object to which they&#39;re attached. The following example will output the context of the message followed by the message itself.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">logger</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span> <span class="nx">message</span> <span class="p">);</span>
</code></pre></div>
<p>While the above example shows the most common type of logger message, the &quot;x&quot; variants are available for specifying deeper context, such as a specific function name. In the following example, the logger message adds an extra one-time label before the message. </p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">logger</span><span class="p">.</span><span class="nx">warnx</span><span class="p">(</span> <span class="s2">&quot;someFunction&quot;</span><span class="p">,</span> <span class="s2">&quot;This message is coming from someFunction.&quot;</span> <span class="p">)</span>
</code></pre></div>
<p>This type of message is primarily for the kernel and drivers, and most likely is not relevant for components. </p>

<h4>Log Files</h4>

<p>Turn logging to files on in <em>lib/vwf/application/reflector.rb</em>. Setting the <em>if</em> statement to true in the <em>def log</em> area will log events to a directory under &quot;log/&quot;. The path will match the application&#39;s location in &quot;public/&quot; plus application/instance/client. Messages are logged to a separate file for each unique time stamp.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">log</span> <span class="n">fields</span><span class="p">,</span> <span class="n">direction</span>
  <span class="k">if</span> <span class="kp">true</span> 
</code></pre></div>
<p>This form of logging is a heavy operation and should only be used for trace-level debugging. This option is planned to be configurable, so the reflector will not need to be edited. At it&#39;s current state, if this option is set to true, the server will need to be restarted to begin logging. </p>

<hr>

<h3>Debugging</h3>

<h4>Browser Console</h4>

<p>Open the developer console to check for any information and error messages. </p>

<ul>
<li>In Mozilla Firefox, download and install <a href="https://addons.mozilla.org/en-us/firefox/addon/firebug">Firebug</a>. Select the bug icon in the upper right of the browser to run, and then select the Console window. </li>
</ul>

<p><img src='images/firebug.png' alt='firebug' style='width:500px' /></p>

<ul>
<li>In Google Chrome, press Ctrl+Shift+J or select the tools menu -&gt; Tools -&gt; Developer Tools -&gt; JavaScript Console. </li>
</ul>

<p><img src='images/chrome.png' alt='chrome' style='width:500px' /></p>

<p>Additionally, in Chrome, the <em>Elements</em> tab allows browsing the HTML of the document. <em>Network</em> allows for viewing of network traffic. <em>Sources</em> allows for browsing the javascript and css associated with the application. <em>Profiles</em> has an option for collecting the JavaScript CPU profile, which can be helpful in optimizing your VWF application. </p>

<h4>Model Source</h4>

<p>By adding <code>//@ sourceURL=<em>file reference</em></code> to the end of scripts in the model file as show below, the script functions will be available in the <em>Sources</em> tab of the browser console. From here, breakpoints and other debugging tools can be used. </p>
<div class="highlight"><pre><code class="yaml language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">scripts</span><span class="p-Indicator">:</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">|</span>
  <span class="no">this.initialize = function() {</span>
    <span class="no">doSomething();</span>
  <span class="no">} //@ sourceURL=index.vwf</span>
</code></pre></div>
<p><img src='images/source.png' alt='chrome' style='width:500px' /></p>

	
	<h2><a name="persistence">Persistence</a></h2>

<p>Persistence is the ability to save the state of any given instance of an application to load at a later time. For example, the state of &#39;instance-x&#39; of &#39;my-app&#39; can be saved at point &#39;A&#39;. Another instance, &#39;instance-y&#39;, of &#39;my-app&#39; can then load the saved state &#39;A&#39;.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">instance-x  o---A---o...
                |
instance-y      o---o---o...
</code></pre></div>
<hr>

<h3>Save the State of an Instance</h3>

<p>The primary way to save the state of an application instance is using a POST HTTP request. (<strong>Note</strong>: The POST ability is only allowable when the server is in development mode by default.)</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="c1">// Save State Information</span>
<span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">state</span> <span class="o">=</span> <span class="nx">vwf</span><span class="p">.</span><span class="nx">getState</span><span class="p">();</span>
</code></pre></div>
<p>The state of the application then needs to be converted to JSON and encoded for URI. </p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="nx">root</span><span class="o">+</span><span class="s2">&quot;/save/&quot;</span><span class="o">+</span><span class="nx">filename</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s2">&quot;Content-type&quot;</span><span class="p">,</span> <span class="s2">&quot;application/x-www-form-urlencoded&quot;</span><span class="p">);</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">&quot;root=&quot;</span><span class="o">+</span><span class="nx">root</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="nx">filename</span><span class="o">+</span><span class="s2">&quot;&amp;filename=saveState&amp;inst=&quot;</span><span class="o">+</span><span class="nx">inst</span><span class="o">+</span><span class="s2">&quot;&amp;timestamp=&quot;</span><span class="o">+</span><span class="nx">timestamp</span><span class="o">+</span><span class="s2">&quot;&amp;extension=.vwf.json&quot;</span><span class="o">+</span><span class="s2">&quot;&amp;jsonState=&quot;</span><span class="o">+</span><span class="nx">json</span><span class="p">);</span>
</code></pre></div>
<p>The above request will store the saved state (json) to &#39;documents/root/filename/saveState_inst.vwf.json&#39; based on the input provided. </p>

<p>If desired, the configuration file data can also be saved in the same manner.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="c1">// Save config file to server</span>
<span class="kd">var</span> <span class="nx">xhrConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
<span class="nx">xhrConfig</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="nx">root</span><span class="o">+</span><span class="s2">&quot;/save/&quot;</span><span class="o">+</span><span class="nx">filename</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">xhrConfig</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s2">&quot;Content-type&quot;</span><span class="p">,</span> <span class="s2">&quot;application/x-www-form-urlencoded&quot;</span><span class="p">);</span>
<span class="nx">xhrConfig</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">&quot;root=&quot;</span><span class="o">+</span><span class="nx">root</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="nx">filename</span><span class="o">+</span><span class="s2">&quot;&amp;filename=saveState&amp;inst=&quot;</span><span class="o">+</span><span class="nx">inst</span><span class="o">+</span><span class="s2">&quot;&amp;timestamp=&quot;</span><span class="o">+</span><span class="nx">timestamp</span><span class="o">+</span><span class="s2">&quot;&amp;extension=.vwf.config.json&quot;</span><span class="o">+</span><span class="s2">&quot;&amp;jsonState=&quot;</span><span class="o">+</span><span class="nx">jsonConfig</span><span class="p">);</span>
</code></pre></div>
<hr>

<h3>List Saved States for an Application</h3>

<p>The primary way to retrieve saved states from the server is using a GET HTTP request via <code>jQuery.getJSON()</code>. There are two available URLs that can be passed as parameters to retrieve states. A URL including &quot;listsaves&quot; will return an object for every saved state of the given application (root). A URL including &quot;listallsaves&quot; will return an object for every saved state for any application. </p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">$</span><span class="p">.</span><span class="nx">getJSON</span><span class="p">(</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nx">root</span> <span class="o">+</span> <span class="s2">&quot;/listsaves&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">data</span> <span class="p">)</span> <span class="p">{</span>
  <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span> <span class="nx">data</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Programmatically append to selection list</span>
  <span class="p">}</span> <span class="p">);</span>
<span class="p">}</span> <span class="p">);</span>
</code></pre></div>
<p>The above call using either &quot;listsaves&quot; or &quot;listallsaves&quot; will return an object array where each object contains the following information:</p>

<ul>
<li>applicationpath: &quot;/app-name&quot;</li>
<li>savename: &quot;filename&quot; </li>
<li>revision: 1234567890 </li>
<li>latestsave: true</li>
</ul>

<p>This information can then be used to generate a list of available saved states, and subsequently, to load one.</p>

<hr>

<h3>Load a Saved State</h3>

<p>The selected saved state can be loaded programmatically via the URL path using the information obtained from the listsaves array object:</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span> <span class="o">=</span> <span class="nx">applicationPath</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nx">instanceID</span> <span class="o">+</span> <span class="s1">&#39;/load/&#39;</span> <span class="o">+</span> <span class="nx">savename</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="p">;</span>
</code></pre></div>
<p>The instance ID is optional. If one is not provided, a new one will be randomly generated. </p>

<hr>

<h3>Default Implementation</h3>

<p>Persistence is a built-in feature of the editor view of the framework by default. </p>

<p>To save the current state of an application instance:</p>

<ol>
<li>Open the Users tab of the <a href="#editor">editor</a>.</li>
<li>Enter a file name for the file to save (if no name is entered, the instance ID from the URL will be selected).</li>
<li>Click the Save button. The document will be saved in /documents/app<em>name/file</em>name/ within the vwf directory.</li>
</ol>

<p>To open a previously saved application:</p>

<ol>
<li>Open the Users tab of the <a href="#editor">editor</a>.</li>
<li>Select the drop down list above the Load button, and choose a file to load.</li>
<li>Click the Load button. The application will be loaded in the current browser tab.</li>
</ol>

<p><strong>Note</strong>: Persistence functionality is only enabled by default in development mode on the server.</p>

	
	<h2><a name="testing">Running Tests</a></h2>

<p>VWF has tests against the server and some of the core client libraries. This page provides information on how to run the tests on your development machine.</p>

<p><strong>Note:</strong> If you are not changing the core VWF files, you probably don&#39;t need to run these tests. See <a href="#troubleshooting">Troubleshooting</a> for info on verifying that your VWF application is working in the browser.</p>

<hr>

<h3>Ruby</h3>

<p>The Ruby tests exercise parts of the Ruby server and are run using rake.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">bundle exec rake test
</code></pre></div>
<hr>

<h3>QUnit (JavaScript)</h3>

<p>The QUnit tests exercise some of the front-end JavaScript code. They require you have PhantomJS installed in order to run.</p>

<p>To install PhantomJS, follow the instructions for your platform.</p>

<h4>Linux</h4>

<ol>
<li><p>Install PhantomJS using APT-GET or YUM install commands depending on your Linux flavor.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">apt-get install phantomjs or yum instal phantomjs
</code></pre></div></li>
<li><p>Run the tests.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">bundle exec rake client:test
</code></pre></div></li>
</ol>

<h4>Mac</h4>

<ol>
<li><p>Install PhantomJS using <a href="http://brew.sh/">Homebrew</a>.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">brew install phantomjs
</code></pre></div></li>
<li><p>Run the tests.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">bundle exec rake client:test
</code></pre></div></li>
</ol>

<h4>Windows</h4>

<ol>
<li><p>Visit <a href="http://phantomjs.org/download.html">PhantomJS Downloads</a> and download the Windows zip file. </p></li>
<li><p>Unzip the file and copy phantomjs.exe to a known location.</p></li>
<li><p>Run the tests, specifying the location of phantomjs.exe, like so.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">PHANTOMJS_BIN=/path/to/phantomjs.exe rake client:test
</code></pre></div>
<p>NOTE: If you have a space in your path, make sure to surround it with quotes 
and escape it with a &quot;\&quot;, like so.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">PHANTOMJS_BIN=&quot;/space\ path/path/to/phantomjs.exe rake client:test
</code></pre></div></li>
</ol>

	
	<h2><a name="pitfalls">Pitfalls</a></h2>

<p>When you begin programming with VWF, it can be easy to wander off the well-worn path that keeps your apps synchronized across users.  Here are a mix of best practices and the most common pitfalls to avoid:</p>

<hr>

<h3>Ensure that you&#39;ve got the picky .yaml formatting right</h3>

<ul>
<li>Two spaces for an indentation.  No tabs!</li>
<li>Put a line return at the end of the file</li>
</ul>

<p>You will know if your .yaml format is incorrect because you will get a 500 (Server Internal) error in your page.</p>

<hr>

<h3>Do not reference <em>this.moniker</em> in the model</h3>

<p><code>this.moniker</code> is a read-only property that contains an id that is unique for every user in the app. It might be tempting to make users behave differently by creating conditionals around this variable. However, doing so breaks VWF&#39;s replicated computation since each user&#39;s model then diverges from the others. All user-specific actions need to be on the view side. To see an example, read the <a href="#multiuser">Create a Multi-user Application</a> cookbook recipe.</p>

<hr>

<h3>Do not access the <em>vwf</em> object anywhere</h3>

<p>The <code>vwf</code> object gives a coder direct access to manipulate the model from the view. This may seem convenient, but it side-steps VWF&#39;s mechanisms to ensure that state stays synchronized between users. In the future this variable will be hidden from us coders for our safety, but in the mean time, steer clear of it! (Though while it is available, it can be useful to investigate the properties of the vwf object from the browser console for debugging purposes). To see an example of how to properly manipulate the model from the view, read the <a href="#2d-interface">Create a 2D Interface</a> cookbook recipe. </p>

<hr>

<h3>When setting a field on a model property, set the whole property</h3>

<p>When changing a property, the property&#39;s setter must be called to trigger VWF&#39;s synchronization mechanism. If one sets only a field of a property (for example, the <em>x</em> field on a vector property), the setter will not be called, and that change will not be replicated to other users. Instead (using the vector example again), create a new vector that has the updated properties and assign the entire vector to the property (to call the property&#39;s setter).</p>

<p>In cases like above when a property (let&#39;s call it <em>containerProperty</em>) has properties of its own, it is often better to make <em>containerProperty</em> a child of the object it is on, rather than a property.  That way its sub-properties can automatically be synchronized when set. Beware of doing this on components, though. See <em>Do not add children to components</em> for more details.</p>

<hr>

<h3>Avoid most uses of global local variables in the model</h3>

<p>Only public properties get saved and loaded with the scene (including the implicit save/load that occurs when a new user joins an existing app). Generally, if a piece of state is important enough to be stored in a global local variable, it&#39;s important enough to get replicated to new users, so store it in a public property. However, global local variables are sometimes useful; for example, pre-computing a value calculated from public properties so that it does not have to be recomputed every frame. But make sure that such a variable contains no new state information or the app will not replicate to new users properly.</p>

<hr>

<h3>Do not add children to components</h3>

<p>When accessing children of an object, the kernel does not delegate to the object&#39;s prototype. In other words, children are not &quot;inherited&quot; from the prototype. If you add children to a component specification and then create an object of that type, the new object will not have the children.</p>

<hr>

<h3>Do not hard-code node ids</h3>

<p>From the view, you will reference nodes by using <a href="#querying">find()</a> to get their nodeIDs and then using that nodeID in <a href="https://demo.virtual.wf/web/docs/jsdoc/2c8753578a.html">kernel calls</a> to get and set properties and call methods. These nodeIDs are not guaranteed to be identical from one run of the application to the next. Therefore, you must not hard-code them. For more information on accessing model nodes from the view, read the <a href="#2d-interface">Create a 2D Interface</a> cookbook recipe.</p>

<hr>

<h3>Do not access the html document from the model</h3>

<p>The model(.yaml) should not have any knowledge of the view(.html). Therefore, the .yaml should not make any reference to the .html document. Instead, the model can throw an event or set a property, etc, that the view can listen for to access or change the document appropriately. For more information about listening for model events from the view], read the <a href="#2d-interface">Create a 2D Interface</a> cookbook recipe. </p>

<hr>

<h3>Do not call view functions from model</h3>

<p>As mentioned in earlier, the model should have no knowledge of the view.  Therefore, the model should not call view functions. Calling view functions is especially dangerous if one passes a model object to a view function; the view function can then change the object without going through the VWF kernel which ensures synchronization between users. That change would only be reflected for the user who made the change locally.</p>

<hr>

<h3>Be aware of asynchronicity</h3>

<p>When programming in the view, calls to get/set model properties and call model methods do not execute immediately (the are sent to the reflector and queued in proper time order).  Therefore, you must wait until the model throws the appropriate event to indicate that your operation is complete.  For more information on accessing the model from the view, read the <a href="#2d-interface">Create a 2D Interface</a> cookbook recipe.</p>

<hr>

<h3>Be careful assigning named functions to event handlers</h3>

<p>If you assign something like:</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">node1</span><span class="p">.</span><span class="nx">event</span> <span class="o">=</span> <span class="nx">node2</span><span class="p">.</span><span class="nx">method</span><span class="p">;</span>
</code></pre></div>
<p>VWF will try to call <em>method</em> from node1, not node2.  Instead, set the event handler like so:</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">node1</span><span class="p">.</span><span class="nx">event</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">node2</span><span class="p">.</span><span class="nx">method</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
	
	<h1><a name="application-api">Application API</a></h1>

<iframe src="https://demo.virtual.wf/web/docs/jsdoc_cmp/index.html" style="height:600px;width:100%;" scrolling="auto" ALLOWTRANSPARENCY="false">Application API Reference</iframe>

	
	<h2><a name="system-api">System API</a></h2>

<iframe src="https://demo.virtual.wf/web/docs/jsdoc/index.html" style="height:600px;width:100%;" scrolling="auto" ALLOWTRANSPARENCY="false">System API Reference</iframe>

	
	<h1><a name="corecontributors">For Core Contributors</a></h1>

<p>This section is for those who don&#39;t just want to write VWF applications, but want to write new drivers and modify the VWF Core. If instead, you wish to develop VWF Applications on top of the framework, please follow the instructions above.</p>

<h4>Prerequisites</h4>

<p>Please make sure you have the following software packages installed:</p>

<ol>
<li>Install <a href="http://nodejs.org/">Node.js</a> for your specific environment.</li>
<li><p>Install <strong>git</strong> for your specific environment.</p>

<ul>
<li><a href="https://code.google.com/p/tortoisegit/">TortoiseGit for Windows</a></li>
<li><a href="http://git-scm.com/download/win">Git Client For Windows</a></li>
<li><a href="http://git-scm.com/download/mac">Git Client for Mac</a></li>
<li><p><a href="http://git-scm.com/download/linux">Git for Linux distributions</a></p>

<ul>
<li><p>Example: Ubuntu</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">sudo apt-get install git
</code></pre></div></li>
</ul></li>
</ul></li>
</ol>

<h4>Development</h4>

<p>Once your environment is set up, the easiest way to start developing is to:</p>

<ol>
<li>Fork the <a href="https://github.com/virtual-world-framework/vwf">VWF repo</a>.</li>
<li><p>Clone your newly forked VWF repo to your local machine:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">git clone https://www.github.com/*username*/vwf --recursive -branch development
</code></pre></div></li>
<li><p>For additional VWF app examples, clone the <a href="https://github.com/virtual-world-framework/vwf-apps">vwf-apps repo</a> into your public directory:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">git clone https://www.github.com/virtual-world-framework/vwf-apps /path/to/public/vwf-apps/
</code></pre></div></li>
<li><p>Edit any npm configuration settings necessary:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">npm config set registry http://registry.npmjs.org/
</code></pre></div></li>
<li><p>Set a network proxy, if required by your network:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">npm config set strict-ssl false
npm config set proxy http://yourproxy.com:80
npm config set https-proxy http://yourproxy.com:80
</code></pre></div></li>
<li><p>Run <code>npm install</code> from the command prompt in your VWF folder to install all the prerequisites for the VWF server.</p></li>
<li><p>Make your code modifications.</p></li>
<li><p>Start your server using <code>npm start</code> from the command prompt in your VWF folder to test your changes. The server runs on port 3000 in development by default. Use a modern browser to view the website and VWF apps. </p></li>
<li><p>After you complete your updates and testing, submit a Pull Request back to the Virtual World Framework Team&#39;s VWF repo.</p></li>
</ol>

<hr>

<h3>Configuring HTTPS/SSL Traffic</h3>

<p>VWF works over an HTTPS/SSL configuration. The following instructions set up a Linux environment running Thin web server with SSL. However, you may use SSL for any combination of operating system. The process below is an extremely simplified view of how SSL is implemented and what part the certificate plays in the entire process.</p>

<p>Normal web traffic is sent unencrypted over the Internet. That is, anyone with access to the right tools can snoop all of that traffic. Obviously, this can lead to problems, especially where security and privacy is necessary, such as in credit card data and bank transactions. The Secure Socket Layer is used to encrypt the data stream between the web server and the web client (the browser).</p>

<h4>Step 1. Generate a Private Key</h4>

<p>The <em>openssl</em> toolkit is used to generate an RSA Private Key and CSR (Certificate Signing Request). It can also be used to generate self-signed certificates which can be used for testing purposes or internal usage.</p>

<p>The first step is to create your RSA Private Key. This key is a 2048 bit key which is encrypted using Triple-DES and stored in a PEM format so that it is readable as ASCII text.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">openssl genrsa -des3 -out server.key 2048
</code></pre></div>
<p>Results:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">Generating RSA private key, 2048 bit long modulus&lt;br/&gt;
.........................................................++++++&lt;br/&gt;
........++++++&lt;br/&gt;
e is 65537 (0x10001)&lt;br/&gt;
Enter PEM pass phrase:&lt;br/&gt;
Verifying password - Enter PEM pass phrase:&lt;br/&gt;&lt;br/&gt;
</code></pre></div>
<h4>Step 2: Generate a CSR (Certificate Signing Request)</h4>

<p>Once the private key is generated, a <em>Certificate Signing Request (CSR)</em> can be generated. The CSR is then used in one of two ways. Ideally, the CSR will be sent to a Certificate Authority, such as Thawte or Verisign who will verify the identity of the requestor and issue a signed certificate. The second option is to self-sign the CSR, which will be demonstrated in the next section.</p>

<p>During the generation of the CSR, you will be prompted for several pieces of information. These are the X.509 attributes of the certificate. One of the prompts will be for &quot;Common Name (e.g., YOUR name)&quot;. It is important that this field be filled in with the fully qualified domain name of the server to be protected by SSL. If the website to be protected will be <em>https://public.akadia.com</em>, then enter <em>public.akadia.com</em> at this prompt. The command to generate the CSR is as follows:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">openssl req -new -key server.key -out server.csr
</code></pre></div>
<p>Results:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">Country Name (2 letter code) \[GB\]:US&lt;br/&gt;
State or Province Name (full name) \[Berkshire\]:Florida&lt;br/&gt;
Locality Name (eg, city) \[Newbury\]:Orlando&lt;br/&gt;
Organization Name (eg, company) \[My Company Ltd\]:Test&lt;br/&gt;
Organizational Unit Name (eg, section) []:Test Technology&lt;br/&gt;
Common Name (eg, your name or your server&#39;s hostname) []:public.whatever.com&lt;br/&gt;
Email Address []:test@test.com&lt;br/&gt;
Please enter the following &#39;extra&#39; attributes&lt;br/&gt;
to be sent with your certificate request&lt;br/&gt;
A challenge password:&lt;br/&gt;
An optional company name:&lt;br/&gt;&lt;br/&gt;
</code></pre></div>
<h4>Step 3: Remove Passphrase from Key</h4>

<p>One unfortunate side-effect of the pass-phrased private key is that Apache will ask for the pass-phrase each time the web server is started. Obviously this is not necessarily convenient as someone will not always be around to type in the pass-phrase, such as after a reboot or crash. mod_ssl includes the ability to use an external program in place of the built-in pass-phrase dialog. However, this is not necessarily the most secure option either. It is possible to remove the Triple-DES encryption from the key, thereby no longer needing to type in a pass-phrase. If the private key is no longer encrypted, it is critical that this file only be readable by the root user! If your system is ever compromised and a third party obtains your unencrypted private key, the corresponding certificate will need to be revoked. With that being said, use the following command to remove the pass-phrase from the key:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">cp server.key server.key.org
openssl rsa -in server.key.org -out server.key
</code></pre></div>
<p>The newly created server.key file has no more passphrase in it.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">-rw-r--r-- 1 root root 745 Jun 29 12:19 server.csr
-rw-r--r-- 1 root root 891 Jun 29 13:22 server.key
-rw-r--r-- 1 root root 963 Jun 29 13:22 server.key.org
</code></pre></div>
<h4>Step 4: Generating a Self-Signed Certificate</h4>

<p>At this point you will need to generate a self-signed certificate because you either don&#39;t plan on having your certificate signed by a CA, or you wish to test your new SSL implementation while the CA is signing your certificate. This temporary certificate will generate an error in the client browser to the effect that the signing certificate authority is unknown and not trusted.</p>

<p>To generate a temporary certificate which is good for 365 days, issue the following command:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt
</code></pre></div>
<p>Results:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">Signature ok&lt;br/&gt;
subject=/C=CH/ST=Test/L=TestName/O=Test Co/OU=Test Technology/CN=public.whatever.com/Email=test@test.com&lt;br/&gt;
Getting Private key&lt;br/&gt;
</code></pre></div>
<h4>Step 5: Installing the Private Key and Certificate</h4>

<p>Thin is capable of reading SSL within a configuration yml file for startup.  First we move the certificates generated to a permanent location.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">mkdir /etc/thin_ssl
cp server.crt /etc/thin_ssl/ssl.crt
cp server.key /etc/thin_ssl/ssl.key
</code></pre></div>
<p>At this point you will want to add three lines to your Thin Server yml file:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">ssl: true
ssl_cert_file: /etc/thin_ssl/ssl.crt
ssl_key_file: /etc/thin_ssl/ssl.key
</code></pre></div>
<p>Restart your thin servers at this point and you should now be able to connect to your server using <em>https://</em>.
Remember that SSL traffic is on port 443, and you will need to have this port open in your firewall.</p>
 
    </div>
  </div>
</div>

<script src="js/jquery-1.10.2.min.js"></script>
<script src="js/bootstrap.min.js"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-30971226-1', 'virtualworldframework.com');
  ga('send', 'pageview');
</script>
